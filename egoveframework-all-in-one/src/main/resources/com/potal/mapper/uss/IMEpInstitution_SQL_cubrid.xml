<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.potal.uss.institution.service.IMEpInstitutionMapper">

    <insert id="insert" parameterType="com.potal.uss.institution.service.IMEpInstitutionVO">
    <selectKey keyProperty="inst_no" resultType="Integer" order="BEFORE">
				SELECT NVL(MAX(instNo),0)+1 FROM ep_institution
		</selectKey>
/* IMEpInstitutionMapper.insert */
INSERT INTO ep_institution (
    inst_no,
    org_name,
    biz_kind,
    biz_no,
    repre_name,
    post,
    addr1,
    addr2,
    member_srl,
    tel,
    fax,
    course_level,
    org_logo_fname,
    org_logo_fpath,
    status,
    org_cert_comment,
    asis_org_userid,
    site_url,
    createdate,
    creator,
    updateddate,
    updator,
    use_yn
) VALUES (
    #{instNo, jdbcType=VARCHAR},
    #{orgName, jdbcType=VARCHAR},
    #{bizKind, jdbcType=VARCHAR},
    #{bizNo, jdbcType=VARCHAR},
    #{repreName, jdbcType=VARCHAR},
    #{post, jdbcType=VARCHAR},
    #{addr1, jdbcType=VARCHAR},
    #{addr2, jdbcType=VARCHAR},
    #{memberSrl, jdbcType=VARCHAR},
    #{tel, jdbcType=VARCHAR},
    #{fax, jdbcType=VARCHAR},
    #{courseLevel, jdbcType=VARCHAR},
    #{orgLogoFname, jdbcType=VARCHAR},
    #{orgLogoFpath, jdbcType=VARCHAR},
    #{status, jdbcType=VARCHAR},
    #{orgCertComment, jdbcType=VARCHAR},
    #{asisOrgUserid, jdbcType=VARCHAR},
    #{siteUrl, jdbcType=VARCHAR},
    #{createdate, jdbcType=VARCHAR},
    #{creator, jdbcType=VARCHAR},
    #{updateddate, jdbcType=VARCHAR},
    #{updator, jdbcType=VARCHAR},
    #{useYn, jdbcType=VARCHAR},

     'N',
    #{frstRegerId, jdbcType=VARCHAR},
    TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
    #{frstRegerIp, jdbcType=VARCHAR}
) 
    </insert>

    <update id="update" parameterType="com.potal.uss.institution.service.IMEpInstitutionVO">
/* IMEpInstitutionMapper.update */
UPDATE ep_institution
   SET 
       inst_no = #{instNo, jdbcType=VARCHAR},
       org_name = #{orgName, jdbcType=VARCHAR},
       biz_kind = #{bizKind, jdbcType=VARCHAR},
       biz_no = #{bizNo, jdbcType=VARCHAR},
       repre_name = #{repreName, jdbcType=VARCHAR},
       post = #{post, jdbcType=VARCHAR},
       addr1 = #{addr1, jdbcType=VARCHAR},
       addr2 = #{addr2, jdbcType=VARCHAR},
       member_srl = #{memberSrl, jdbcType=VARCHAR},
       tel = #{tel, jdbcType=VARCHAR},
       fax = #{fax, jdbcType=VARCHAR},
       course_level = #{courseLevel, jdbcType=VARCHAR},
       org_logo_fname = #{orgLogoFname, jdbcType=VARCHAR},
       org_logo_fpath = #{orgLogoFpath, jdbcType=VARCHAR},
       status = #{status, jdbcType=VARCHAR},
       org_cert_comment = #{orgCertComment, jdbcType=VARCHAR},
       asis_org_userid = #{asisOrgUserid, jdbcType=VARCHAR},
       site_url = #{siteUrl, jdbcType=VARCHAR},
       createdate = #{createdate, jdbcType=VARCHAR},
       creator = #{creator, jdbcType=VARCHAR},
       updateddate = #{updateddate, jdbcType=VARCHAR},
       updator = #{updator, jdbcType=VARCHAR},
       use_yn = #{useYn, jdbcType=VARCHAR}
 WHERE
       inst_no = #{instNo}

 
    </update>


    <resultMap id="selectDetailResultMap" type="com.potal.uss.institution.service.IMEpInstitutionResultSet">
        <result column="A.instNo" property="epInstitution.instNo"/>
        <result column="A.orgName" property="epInstitution.orgName"/>
        <result column="A.bizKind" property="epInstitution.bizKind"/>
        <result column="A.bizNo" property="epInstitution.bizNo"/>
        <result column="A.repreName" property="epInstitution.repreName"/>
        <result column="A.post" property="epInstitution.post"/>
        <result column="A.addr1" property="epInstitution.addr1"/>
        <result column="A.addr2" property="epInstitution.addr2"/>
        <result column="A.memberSrl" property="epInstitution.memberSrl"/>
        <result column="A.tel" property="epInstitution.tel"/>
        <result column="A.fax" property="epInstitution.fax"/>
        <result column="A.courseLevel" property="epInstitution.courseLevel"/>
        <result column="A.orgLogoFname" property="epInstitution.orgLogoFname"/>
        <result column="A.orgLogoFpath" property="epInstitution.orgLogoFpath"/>
        <result column="A.status" property="epInstitution.status"/>
        <result column="A.orgCertComment" property="epInstitution.orgCertComment"/>
        <result column="A.asisOrgUserid" property="epInstitution.asisOrgUserid"/>
        <result column="A.siteUrl" property="epInstitution.siteUrl"/>
        <result column="A.createdate" property="epInstitution.createdate"/>
        <result column="A.creator" property="epInstitution.creator"/>
        <result column="A.updateddate" property="epInstitution.updateddate"/>
        <result column="A.updator" property="epInstitution.updator"/>
        <result column="A.useYn" property="epInstitution.useYn"/>

    </resultMap>
    <select id="selectDetail" parameterType="com.potal.uss.institution.service.IMEpInstitutionVO" resultMap="selectDetailResultMap">
        /* IMEpInstitutionMapper.selectDetail */
SELECT 
       A.inst_no AS "A.instNo",
       A.org_name AS "A.orgName",
       A.biz_kind AS "A.bizKind",
       A.biz_no AS "A.bizNo",
       A.repre_name AS "A.repreName",
       A.post AS "A.post",
       A.addr1 AS "A.addr1",
       A.addr2 AS "A.addr2",
       A.member_srl AS "A.memberSrl",
       A.tel AS "A.tel",
       A.fax AS "A.fax",
       A.course_level AS "A.courseLevel",
       A.org_logo_fname AS "A.orgLogoFname",
       A.org_logo_fpath AS "A.orgLogoFpath",
       A.status AS "A.status",
       A.org_cert_comment AS "A.orgCertComment",
       A.asis_org_userid AS "A.asisOrgUserid",
       A.site_url AS "A.siteUrl",
       A.createdate AS "A.createdate",
       A.creator AS "A.creator",
       A.updateddate AS "A.updateddate",
       A.updator AS "A.updator",
       A.use_yn AS "A.useYn"
  
  FROM ep_institution A
 WHERE
       inst_no = #{instNo}

    </select>


    <resultMap id="selectListResultMap" type="com.potal.uss.institution.service.IMEpInstitutionResultSet">
        <result column="A.instNo" property="epInstitution.instNo"/>
        <result column="A.orgName" property="epInstitution.orgName"/>
        <result column="A.bizKind" property="epInstitution.bizKind"/>
        <result column="A.bizKindName" property="epInstitution.bizKindName"/>
        <result column="A.bizNo" property="epInstitution.bizNo"/>
        <result column="A.repreName" property="epInstitution.repreName"/>
        <result column="A.post" property="epInstitution.post"/>
        <result column="A.addr1" property="epInstitution.addr1"/>
        <result column="A.addr2" property="epInstitution.addr2"/>
        <result column="A.memberSrl" property="epInstitution.memberSrl"/>
        <result column="A.tel" property="epInstitution.tel"/>
        <result column="A.fax" property="epInstitution.fax"/>
        <result column="A.courseLevel" property="epInstitution.courseLevel"/>
        <result column="A.orgLogoFname" property="epInstitution.orgLogoFname"/>
        <result column="A.orgLogoFpath" property="epInstitution.orgLogoFpath"/>
        <result column="A.status" property="epInstitution.status"/>
        <result column="A.orgCertComment" property="epInstitution.orgCertComment"/>
        <result column="A.asisOrgUserid" property="epInstitution.asisOrgUserid"/>
        <result column="A.siteUrl" property="epInstitution.siteUrl"/>
        <result column="A.createdate" property="epInstitution.createdate"/>
        <result column="A.creator" property="epInstitution.creator"/>
        <result column="A.updateddate" property="epInstitution.updateddate"/>
        <result column="A.updator" property="epInstitution.updator"/>
        <result column="A.useYn" property="epInstitution.useYn"/>

    </resultMap>
    <select id="selectList" parameterType="com.potal.uss.institution.service.IMEpInstitutionCondition" resultMap="selectListResultMap">
/* IMEpInstitutionMapper.selectList */
         <if test='currentPageNo != 0'>
SELECT * FROM ( SELECT rownum rn, TB.* FROM (
        </if>
SELECT
       A.inst_no AS "A.instNo",
       A.org_name AS "A.orgName",
       A.biz_kind AS "A.bizKind",
      (SELECT cd_nm FROM ep_cot_grpcd WHERE grp_cd='CM_ORG_TYPE' AND cd = A.biz_kind) "A.bizKindName",
       A.biz_no AS "A.bizNo",
       A.repre_name AS "A.repreName",
       A.post AS "A.post",
       A.addr1 AS "A.addr1",
       A.addr2 AS "A.addr2",
       A.member_srl AS "A.memberSrl",
       A.tel AS "A.tel",
       A.fax AS "A.fax",
       A.course_level AS "A.courseLevel",
       A.org_logo_fname AS "A.orgLogoFname",
       A.org_logo_fpath AS "A.orgLogoFpath",
       A.status AS "A.status",
       A.org_cert_comment AS "A.orgCertComment",
       A.asis_org_userid AS "A.asisOrgUserid",
       A.site_url AS "A.siteUrl",
       A.createdate AS "A.createdate",
       A.creator AS "A.creator",
       A.updateddate AS "A.updateddate",
       A.updator AS "A.updator",
       A.use_yn AS "A.useYn"

  FROM ep_institution A
 WHERE 1=1
 		 <if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("org_name")'>
       			AND A.org_name LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("repre_name")'>
       			AND A.repre_name LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("biz_no")'>
       			AND A.biz_no LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
 		 <if test='scStatus != null and !scStatus.equals("")'>
       			AND A.status = #{scStatus}
        </if>
 		 <if test='scOrgName != null and !scOrgName.equals("")'>
       			AND A.org_name LIKE '%' || #{scOrgName} || '%'
        </if>
 		 <if test='scBizNo != null and !scBizNo.equals("")'>
       			AND A.biz_no LIKE '%' || #{scBizNo} || '%'
        </if>
 		 <if test='scBizKind != null and !scBizKind.equals("")'>
       			AND A.biz_kind LIKE '%' || #{scBizKind} || '%'
        </if>
 	
 	
 	
 	
 	
  		<choose>
            <when test='orderbyKey == 1'>ORDER BY A.org_name ASC</when>
            <when test='orderbyKey == -1'>ORDER BY A.org_name DESC</when>
            <otherwise>ORDER BY A.org_name DESC</otherwise>
        </choose>

        <if test='currentPageNo != 0'>
        ) TB ) WHERE rn BETWEEN #{firstItemNo}+1  AND #{firstItemNo} + #{recordCountPerPage}
        </if>
    </select>

    <select id="selectListCount" parameterType="com.potal.uss.institution.service.IMEpInstitutionCondition" resultType="int">
/* IMEpInstitutionMapper.selectListCount */
SELECT COUNT(*) 
  FROM ep_institution A
 WHERE 1=1
 		 <if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("org_name")'>
       			AND A.org_name LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("repre_name")'>
       			AND A.repre_name LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("biz_no")'>
       			AND A.biz_no LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
 		 <if test='scStatus != null and !scStatus.equals("")'>
       			AND A.status = #{scStatus}
        </if>
 		 <if test='scOrgName != null and !scOrgName.equals("")'>
       			AND A.org_name LIKE '%' || #{scOrgName} || '%'
        </if>
 		 <if test='scBizNo != null and !scBizNo.equals("")'>
       			AND A.biz_no LIKE '%' || #{scBizNo} || '%'
        </if>
 		 <if test='scBizKind != null and !scBizKind.equals("")'>
       			AND A.biz_kind LIKE '%' || #{scBizKind} || '%'
        </if>
 
    </select>
    <select id="selectMemberUser" parameterType="map" resultType="com.potal.uss.institution.service.IMEpInstitutionVO">
/* IMEpInstitutionMapper.selectListCount */
SELECT member_srl AS "memberSrl",
       user_id AS "userId",
       name AS "name",
       email AS "email",
       tel AS "tel"
FROM   kntool_member WHERE user_id=#{userId}
LIMIT 1
    </select>
    
    <select id="selectListEduAply" parameterType="map" resultType="com.intermorph.uss.hstry.service.IMEduAplyHstryVO">
    /* IMEpInstitutionMapper.selectListEduAply */
    
    SELECT	a.member_srl AS "memberSrl",
		b.user_id AS "mmbrId",
		B.name  AS "mmbrNm",
		b.tel AS "mblTelno",
		b.email AS "eml",
		b.birthday AS "brdt",
		a.course_app_no AS "rcptCode",
		c.course_name AS "crsNm",
		c.course_type AS "crsDvsn",
		DECODE(c.course_type, '1001', '정규', '1002', '간이', '2001', '보수') AS "crsDvsnCodeNm",
		(SELECT org_name FROM ep_institution c WHERE a.inst_no = c.inst_no) AS "agncyNm",
		a.inst_no AS "agncyCode",
		a.createdate AS "rcptYmd",
		a.course_status  AS "sttsCode",
		DECODE(a.course_status, '4003', '자격발급', '4002', '수료', '4001', '미수료', '3003', '미선정', '3002', '예비선정', '3001', '선정', '2001', '신청취소', '1001', '신청완료')   AS "stts",
		(SELECT CONCAT(d.edu_sdate, ' ~ ' , d.edu_edate) from ep_orgedu_schedule d WHERE d.course_edu_no = a.course_edu_no) AS "dpstYmdInfo",
		a.cert_number AS "lcncIssuCode",
		a.cert_number AS "lcncCode",
		(SELECT cd_nm FROM ep_cot_grpcd WHERE grp_cd = 'SM_COURSE_LEVEL' AND cd = A.cert_level )  AS "acqsGrd",
		a.cert_level AS "acqsgrdcode",
		a.cert_date AS "qlfcAcqsYmd",
		a.cert_date AS "issuYmd"
	FROM ep_course_appinfo a
	INNER JOIN kntool_member b ON a.member_srl = b.member_srl
	INNER JOIN ep_envedu_course c ON a.seq = c.seq
	ORDER BY a.createdate DESC
    </select>
</mapper>