<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.intermorph.cmmn.egov.service.IMEgovMapper">



	  <resultMap id="selectListAuthMenuResultMap" type="com.intermorph.cmmn.egov.service.IMEgovResultSet">
        <result column="A.menuNo" property="menuManage.menuNo"/>
        <result column="A.menuNm" property="menuManage.menuNm"/>
        <result column="A.menuOrdr" property="menuManage.menuOrdr"/>
        <result column="A.upperMenuId" property="menuManage.upperMenuId"/>
        <result column="A.relateImagePath" property="menuManage.relateImagePath"/>
        <result column="C.url" property="progrmManage.url"/>
      </resultMap>

    <select id="selectListAuthMenu" parameterType="com.intermorph.cmmn.egov.service.IMEgovVO" resultMap="selectListAuthMenuResultMap">
/* IMEgovMapper.selectListAuthMenu */			
	SELECT  A.MENU_NO AS "A.menuNo"
				, A.MENU_ORDR AS "A.menuOrdr"
				, A.MENU_NM AS "A.menuNm"
				, A.upper_menu_no AS  "A.upperMenuId"
				, A.relate_image_path AS "A.relateImagePath"
				, C.url AS "C.url"
			FROM COMTNMENUINFO A
			INNER JOIN COMTNMENUCREATDTLS B ON A.MENU_NO=B.MENU_NO AND AUTHOR_CODE =#{authorCode}
			INNER JOIN  COMTNPROGRMLIST C ON A.progrm_file_nm=C.progrm_file_nm
			WHERE A.MENU_NO > 0
			ORDER BY A.MENU_ORDR,A.MENU_NO
    </select>
    
    
    
	<resultMap id="boardList" type="egovframework.com.cop.bbs.service.BoardVO">
		<result property="bbsId" column="BBS_ID"/>
		<result property="nttId" column="NTT_ID"/>
		<result property="nttSj" column="NTT_SJ"/>
		<result property="nttCn" column="NTT_CN"/>
		<result property="frstRegisterId" column="FRST_REGISTER_ID"/>
		<result property="frstRegisterNm" column="FRST_REGISTER_NM"/>
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM"/>
		<result property="inqireCo" column="RDCNT"/>
		<result property="parnts" column="PARNTSCTT_NO"/>
		<result property="replyAt" column="ANSWER_AT"/>		
		<result property="replyLc" column="ANSWER_LC"/>
		<result property="useAt" column="USE_AT"/>
		<result property="atchFileId" column="ATCH_FILE_ID"/>
		<result property="ntceBgnde" column="NTCE_BGNDE"/>
		<result property="ntceEndde" column="NTCE_ENDDE"/>
		<result property="sjBoldAt" column="SJ_BOLD_AT"/>
		<result property="noticeAt" column="NOTICE_AT"/>
		<result property="secretAt" column="SECRET_AT"/>
		<result property="commentCo" column="COMMENT_CO"/>
		<result property="agncyNm" column="agncy_nm"/>
	</resultMap>
	
	
	
	<select id="selectArticleMainList" parameterType="egovframework.com.cop.bbs.service.BoardVO" resultMap="boardList">
		/* IMEgovMapper.selectArticleMainList */
		SELECT * FROM ( SELECT rownum rn, TB.* FROM (
			SELECT
				a.NTT_ID, a.NTT_SJ,a.NTT_CN, a.FRST_REGISTER_ID, NVL(b.USER_NM, a.NTCR_NM) as FRST_REGISTER_NM,
				TO_CHAR(a.FRST_REGIST_PNTTM, 'YYYY-MM-DD') as FRST_REGIST_PNTTM,
				(SELECT agncy_nm FROM im_agncy  WHERE agncy_id= a.agncy_id) agncy_nm,
				a.RDCNT, a.PARNTSCTT_NO, a.ANSWER_AT, a.ANSWER_LC, a.USE_AT, a.ATCH_FILE_ID,
				a.BBS_ID, rtrim(a.NTCE_BGNDE) NTCE_BGNDE, rtrim(a.NTCE_ENDDE) NTCE_ENDDE, a.SJ_BOLD_AT, a.NOTICE_AT, a.SECRET_AT, c.COMMENT_CO
			FROM
				COMTNBBS a
			LEFT OUTER JOIN 
				COMVNUSERMASTER b
			ON a.FRST_REGISTER_ID = b.ESNTL_ID 
			LEFT OUTER JOIN
				(SELECT NTT_ID, BBS_ID, COUNT(1) AS COMMENT_CO 
				   FROM COMTNCOMMENT 
				 WHERE USE_AT = 'Y' 
				 GROUP BY NTT_ID, BBS_ID) c
			ON a.NTT_ID = c.NTT_ID
			WHERE
				a.BBS_ID = #{bbsId}
			AND a.USE_AT = 'Y'
			
		
       			 <![CDATA[
       			AND TO_CHAR(SYSDATETIME, 'yyyy-mm-dd')>=a.ntce_bgnde AND TO_CHAR(SYSDATETIME, 'yyyy-mm-dd')<= a.ntce_endde
       			]]>
 
					
			ORDER BY a.SORT_ORDR DESC, NTT_NO ASC
			) TB ) Z WHERE rn BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordCountPerPage}
						
	</select>	
	
	
	<resultMap id="FaqManage" type="egovframework.com.uss.olh.faq.service.FaqVO">
		<result property="faqId" column="FAQ_ID"/>
		<result property="qestnSj" column="QESTN_SJ"/>
		<result property="qestnCn" column="QESTN_CN"/>
		<result property="answerCn" column="ANSWER_CN"/>
		<result property="inqireCo" column="RDCNT"/>
		<result property="atchFileId" column="ATCH_FILE_ID"/>		
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM"/>
		<result property="frstRegisterId" column="FRST_REGISTER_ID"/>
		<result property="lastUpdusrPnttm" column="LAST_UPDT_PNTTM"/>
		<result property="lastUpdusrId" column="LAST_UPDUSR_ID"/>				
	</resultMap>
	
	<select id="selectFaqMainList" parameterType="egovframework.com.cop.bbs.service.BoardVO" resultMap="FaqManage">
		/* IMEgovMapper.selectFaqMainList */
		SELECT * FROM ( SELECT rownum rn, TB.* FROM (
			 SELECT   FAQ_ID,
          QESTN_SJ,
          QESTN_CN,
          ANSWER_CN,
          RDCNT,
          ATCH_FILE_ID,
          TO_CHAR(FRST_REGIST_PNTTM,'YYYY-MM-DD') FRST_REGIST_PNTTM,
          TO_CHAR(LAST_UPDT_PNTTM,'YYYY-MM-DD') LAST_UPDUSR_PNTTM,
          FRST_REGISTER_ID,
          LAST_UPDUSR_ID
		 FROM     COMTNFAQINFO
		 ORDER BY FAQ_ID DESC
			) TB ) Z WHERE rn BETWEEN #{firstIndex} + 1 AND #{firstIndex} + #{recordCountPerPage}
						
	</select>	
	
	
	
	
	
	
	
	

    <resultMap id="selectMainListCrsResultMap" type="com.intermorph.crs.crs.service.IMCrsResultSet">
        <result column="A.crsId" property="crs.crsId"/>
        <result column="A.crsMstrId" property="crs.crsMstrId"/>
        <result column="A.eduYear" property="crs.eduYear"/>
        <result column="A.eduRnd" property="crs.eduRnd"/>
        <result column="B.crsGrdCdv" property="crsMstr.crsGrdCdv"/>
        <result column="B.crsDvsnCdv" property="crsMstr.crsDvsnCdv"/>
        <result column="A.eduAplTerm_bgnDt" property="crs.eduAplTerm_bgnDt"/>
        <result column="A.eduAplTerm_endDt" property="crs.eduAplTerm_endDt"/>
        <result column="A.eduTerm_bgnDt" property="crs.eduTerm_bgnDt"/>
        <result column="A.eduTerm_endDt" property="crs.eduTerm_endDt"/>
        <result column="E.agncyNm" property="agncy.agncyNm"/>
        <result column="procType" property="procType"/>

    </resultMap>
    <select id="selectMainListCrs" parameterType="map" resultMap="selectMainListCrsResultMap">
/* IMEgovMapper.selectMainListCrs */
         SELECT AA.* from
		 (
		 SELECT  A.crs_id        AS "A.crsId",
		                        A.crs_mstr_id    AS "A.crsMstrId",
		                        A.edu_year       AS "A.eduYear",
		                        A.edu_rnd        AS "A.eduRnd",
		                        B.crs_grd_cdv    AS "B.crsGrdCdv",
		                        B.crs_dvsn_cdv   AS "B.crsDvsnCdv",
		                        C.bgn_dt,
		                        C.bgn_dt         AS "A.eduAplTerm_bgnDt" ,
		                        C.end_dt         AS "A.eduAplTerm_endDt" ,
		                        D.bgn_dt         AS "A.eduTerm_bgnDt" ,
		                        D.end_dt         AS "A.eduTerm_endDt" ,
		                        E.agncy_nm       AS "E.agncyNm",
							<![CDATA[
		                         CASE
		                                 WHEN TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss')    >C.bgn_dt
		                                 AND      TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss')< C.end_dt
		                                 THEN '0'
		                                 WHEN TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss')<C.bgn_dt
		                                 THEN '1'
		                                 ELSE '3'
		                        END AS procTypeSort,
		                        CASE
		                                 WHEN TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss')    >C.bgn_dt
		                                 AND      TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss')< C.end_dt
		                                 THEN 'I'
		                                 WHEN TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss')<C.bgn_dt
		                                 THEN 'W'
		                                 ELSE 'E'
		                        END AS "procType"
							]]>
		               FROM     im_crs A
		                        INNER JOIN im_crs_mstr B
		                        ON       A.crs_mstr_id=B.crs_mstr_id
		                        INNER JOIN im_cmmn_dt C
		                        ON       A.crs_id=C.tbl_ref_id
		                        AND      C.tbl_id='IM_CRS'
		                        AND      C.ref_nm='eduAplTerm'
		                        INNER JOIN im_cmmn_dt D
		                        ON       A.crs_id=D.tbl_ref_id
		                        AND      D.tbl_id='IM_CRS'
		                        AND      D.ref_nm='eduTerm'
		                        INNER JOIN im_agncy E
		                        ON       A.agncy_id                     =E.agncy_id
		               WHERE    A.del_yn                                = 'N'
				        <if test='scCrsGrdCdv != null and !scCrsGrdCdv.equals("")'>
				       			AND B.crs_grd_cdv = #{scCrsGrdCdv}
				        </if>
				         AND B.crs_dvsn_cdv != 'CRS_DVSN_003'
		               AND      A.stts_cdv                              = 'STTS_02'
		) AA ORDER BY procTypeSort, bgn_dt DESC 
		LIMIT ${limitNumber}
    </select>
    
    
    
    
	<select id="selectUserId" parameterType="String" resultType="String">
		/* IMEgovMapper.selectUserId */
		 SELECT
                ESNTL_ID          uniqId
            FROM COMTNGNRLMBER
            WHERE MBER_ID=#{mberId}
						
	</select>
	
	
	
	
	<resultMap id="fileList" type="egovframework.com.cmm.service.FileVO">
		<result property="atchFileId" column="ATCH_FILE_ID"/>
		<result property="fileCn" column="FILE_CN"/>
		<result property="fileExtsn" column="FILE_EXTSN"/>
		<result property="fileMg" column="FILE_SIZE"/>
		<result property="fileSn" column="FILE_SN"/>
		<result property="fileStreCours" column="FILE_STRE_COURS"/>
		<result property="orignlFileNm" column="ORIGNL_FILE_NM"/>
		<result property="streFileNm" column="STRE_FILE_NM"/>
		<result property="creatDt" column="CREAT_DT"/>			
	</resultMap>
	


 	<select id="selectFileList" parameterType="map" resultMap="fileList">
 		
			SELECT 
				a.ATCH_FILE_ID, b.FILE_CN, b.FILE_SN, b.FILE_STRE_COURS, b.STRE_FILE_NM,
				b.FILE_EXTSN, b.ORIGNL_FILE_NM, b.FILE_SIZE, a.CREAT_DT
			FROM
				COMTNFILE a, COMTNFILEDETAIL b
			WHERE
				a.ATCH_FILE_ID = #{atchFileId}
			AND 
				a.ATCH_FILE_ID = b.ATCH_FILE_ID
			AND 
				a.USE_AT = 'Y'				
			ORDER BY b.FILE_SN	
 		
 	</select>	

</mapper>