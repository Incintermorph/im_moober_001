<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.intermorph.cmmn.file.service.IMCmmnFileMapper">

    <insert id="insert" parameterType="com.intermorph.cmmn.file.service.IMCmmnFileVO" useGeneratedKeys="false">
/* IMCmmnFileMapper.insert */
INSERT INTO im_cmmn_file (
    cmmn_file_id,
    file_id,
    file_nm,
    file_tpc,
    mmbr_accss_yn,
    rmks,
    dwld_cnt,

    del_yn,
    frst_reger_id,
    frst_reg_dt,
    frst_reger_ip
) VALUES (
    #{cmmnFileId, jdbcType=VARCHAR},
    #{fileId, jdbcType=VARCHAR},
    #{fileNm, jdbcType=VARCHAR},
    #{fileTpc, jdbcType=VARCHAR},
    #{mmbrAccssYn, jdbcType=VARCHAR},
    #{rmks, jdbcType=VARCHAR},
    #{dwldCnt, jdbcType=VARCHAR},

     'N',
    #{frstRegerId, jdbcType=VARCHAR},
    TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
    #{frstRegerIp, jdbcType=VARCHAR}
) 
    </insert>

    <update id="update" parameterType="com.intermorph.cmmn.file.service.IMCmmnFileVO">
/* IMCmmnFileMapper.update */
UPDATE im_cmmn_file
   SET 
   		<if test='fileId != null'>
       file_id = #{fileId, jdbcType=VARCHAR},
       </if>
       <if test='fileNm != null'>
       file_nm = #{fileNm, jdbcType=VARCHAR},
       </if>
       <if test='fileTpc != null'>
       file_tpc = #{fileTpc, jdbcType=VARCHAR},
       </if>
       <if test='mmbrAccssYn != null'>
       mmbr_accss_yn = #{mmbrAccssYn, jdbcType=VARCHAR},
       </if>
       <if test='rmks != null'>
       rmks = #{rmks, jdbcType=VARCHAR},
       </if>       
       <if test='dwldCnt != null'>
       dwld_cnt = #{dwldCnt, jdbcType=VARCHAR},
       </if>
	   last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR}
 WHERE
       cmmn_file_id = #{cmmnFileId}

   AND del_yn = 'N' 
    </update>
    <update id="updateDownCnt" parameterType="com.intermorph.cmmn.file.service.IMCmmnFileVO">
/* IMCmmnFileMapper.updateDownCnt */
UPDATE im_cmmn_file
   SET 
       dwld_cnt = dwld_cnt+1
    
 WHERE
       cmmn_file_id = #{cmmnFileId} 
    </update>

    <update id="delete" parameterType="com.intermorph.cmmn.file.service.IMCmmnFileVO">
/* IMCmmnFileMapper.delete */
UPDATE im_cmmn_file 
   SET last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR},
       del_yn = 'Y' 
 WHERE 
       cmmn_file_id = #{cmmnFileId}

   AND del_yn = 'N'
    </update>

    <resultMap id="selectDetailResultMap" type="com.intermorph.cmmn.file.service.IMCmmnFileResultSet">
        <result column="A.cmmnFileId" property="cmmnFile.cmmnFileId"/>
        <result column="A.fileId" property="cmmnFile.fileId"/>
        <result column="A.fileNm" property="cmmnFile.fileNm"/>
        <result column="A.fileTpc" property="cmmnFile.fileTpc"/>
        <result column="A.mmbrAccssYn" property="cmmnFile.mmbrAccssYn"/>
        <result column="A.rmks" property="cmmnFile.rmks"/>
        <result column="A.dwldCnt" property="cmmnFile.dwldCnt"/>
        <result column="A.delYn" property="cmmnFile.delYn"/>
        <result column="A.frstRegerId" property="cmmnFile.frstRegerId"/>
        <result column="A.frstRegDt" property="cmmnFile.frstRegDt"/>
        <result column="A.frstRegerIp" property="cmmnFile.frstRegerIp"/>
        <result column="A.lastMdferId" property="cmmnFile.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="cmmnFile.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="cmmnFile.lastMdferIp"/>
		<collection column="{atchFileId=fileId}" property="fileList" javaType="List" 
            ofType="egovframework.com.cmm.service.FileVO" select="com.intermorph.cmmn.egov.service.IMEgovMapper.selectFileList"/>
    </resultMap>
    <select id="selectDetail" parameterType="com.intermorph.cmmn.file.service.IMCmmnFileVO" resultMap="selectDetailResultMap">
        /* IMCmmnFileMapper.selectDetail */
SELECT 
       A.cmmn_file_id AS "A.cmmnFileId",
       A.file_id AS "A.fileId",
       A.file_id AS "fileId",
       A.file_nm AS "A.fileNm",
       A.file_tpc AS "A.fileTpc",
       A.mmbr_accss_yn AS "A.mmbrAccssYn",
       A.rmks AS "A.rmks",
       A.dwld_cnt AS "A.dwldCnt",
       A.del_yn AS "A.delYn",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp"
  
  FROM im_cmmn_file A
 WHERE
       cmmn_file_id = #{cmmnFileId}

   AND A.del_yn = 'N'
    </select>


    <resultMap id="selectListResultMap" type="com.intermorph.cmmn.file.service.IMCmmnFileResultSet">
        <result column="A.cmmnFileId" property="cmmnFile.cmmnFileId"/>
        <result column="A.fileId" property="cmmnFile.fileId"/>
        <result column="A.fileNm" property="cmmnFile.fileNm"/>
        <result column="A.fileTpc" property="cmmnFile.fileTpc"/>
        <result column="A.mmbrAccssYn" property="cmmnFile.mmbrAccssYn"/>
        <result column="A.rmks" property="cmmnFile.rmks"/>
        <result column="A.dwldCnt" property="cmmnFile.dwldCnt"/>
        <result column="A.delYn" property="cmmnFile.delYn"/>
        <result column="A.frstRegerId" property="cmmnFile.frstRegerId"/>
        <result column="A.frstRegDt" property="cmmnFile.frstRegDt"/>
        <result column="A.frstRegerIp" property="cmmnFile.frstRegerIp"/>
        <result column="A.lastMdferId" property="cmmnFile.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="cmmnFile.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="cmmnFile.lastMdferIp"/>

    </resultMap>
    <select id="selectList" parameterType="com.intermorph.cmmn.file.service.IMCmmnFileCondition" resultMap="selectListResultMap">
/* IMCmmnFileMapper.selectList */
         <if test='currentPageNo != 0'>
SELECT * FROM ( SELECT rownum rn, TB.* FROM (
        </if>
SELECT
       A.cmmn_file_id AS "A.cmmnFileId",
       A.file_id AS "A.fileId",
       A.file_nm AS "A.fileNm",
       A.file_tpc AS "A.fileTpc",
       A.mmbr_accss_yn AS "A.mmbrAccssYn",
       A.rmks AS "A.rmks",
       A.dwld_cnt AS "A.dwldCnt",
       A.del_yn AS "A.delYn",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp"

  FROM im_cmmn_file A
 WHERE A.del_yn = 'N'
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("fileTpc")'>
       			AND A.file_tpc LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("fileNm")'>
       			AND A.file_nm LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
  		<choose>
            <when test='orderbyKey == 3'>ORDER BY A.file_tpc ASC</when>
            <when test='orderbyKey == -3'>ORDER BY A.file_tpc DESC</when>
            <when test='orderbyKey == 2'>ORDER BY A.file_nm ASC</when>
            <when test='orderbyKey == -2'>ORDER BY A.file_nm DESC</when>
            <when test='orderbyKey == 1'>ORDER BY A.frst_reg_dt ASC</when>
            <when test='orderbyKey == -1'>ORDER BY A.frst_reg_dt DESC</when>
            <otherwise>ORDER BY A.frst_reg_dt DESC</otherwise>
        </choose>

        <if test='currentPageNo != 0'>
        ) TB ) WHERE rn BETWEEN #{firstItemNo}+1  AND #{firstItemNo} + #{recordCountPerPage}
        </if>
    </select>

    <select id="selectListCount" parameterType="com.intermorph.cmmn.file.service.IMCmmnFileCondition" resultType="int">
/* IMCmmnFileMapper.selectListCount */
SELECT COUNT(*) 
  FROM im_cmmn_file A
 WHERE A.del_yn = 'N'  
 <if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("fileTpc")'>
       			AND A.file_tpc LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("fileNm")'>
       			AND A.file_nm LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
    </select>
</mapper>