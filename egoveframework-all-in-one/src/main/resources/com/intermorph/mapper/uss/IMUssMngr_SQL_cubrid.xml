<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.intermorph.uss.mngr.service.IMUssMngrMapper">

   

    <resultMap id="selectDetailResultMap" type="com.intermorph.uss.mngr.service.IMUssMngrResultSet">
        <result column="A.emplyrId" property="ussMngr.emplyrId"/>
        <result column="A.orgnztId" property="ussMngr.orgnztId"/>
        <result column="A.userNm" property="ussMngr.userNm"/>
        <result column="A.password" property="ussMngr.password"/>
        <result column="A.emplNo" property="ussMngr.emplNo"/>
        <result column="A.ihidnum" property="ussMngr.ihidnum"/>
        <result column="A.sexdstnCode" property="ussMngr.sexdstnCode"/>
        <result column="A.brthdy" property="ussMngr.brthdy"/>
        <result column="A.fxnum" property="ussMngr.fxnum"/>
        <result column="A.houseAdres" property="ussMngr.houseAdres"/>
        <result column="A.passwordHint" property="ussMngr.passwordHint"/>
        <result column="A.passwordCnsr" property="ussMngr.passwordCnsr"/>
        <result column="A.houseEndTelno" property="ussMngr.houseEndTelno"/>
        <result column="A.areaNo" property="ussMngr.areaNo"/>
        <result column="A.detailAdres" property="ussMngr.detailAdres"/>
        <result column="A.zip" property="ussMngr.zip"/>
        <result column="A.offmTelno" property="ussMngr.offmTelno"/>
        <result column="A.mbtlnum" property="ussMngr.mbtlnum"/>
        <result column="A.emailAdres" property="ussMngr.emailAdres"/>
        <result column="A.ofcpsNm" property="ussMngr.ofcpsNm"/>
        <result column="A.houseMiddleTelno" property="ussMngr.houseMiddleTelno"/>
        <result column="A.groupId" property="ussMngr.groupId"/>
        <result column="A.pstinstCode" property="ussMngr.pstinstCode"/>
        <result column="A.emplyrSttusCode" property="ussMngr.emplyrSttusCode"/>
        <result column="A.esntlId" property="ussMngr.esntlId"/>
        <result column="A.crtfcDnValue" property="ussMngr.crtfcDnValue"/>
        <result column="A.sbscrbDe" property="ussMngr.sbscrbDe"/>
        <result column="A.lockAt" property="ussMngr.lockAt"/>
        <result column="A.lockCnt" property="ussMngr.lockCnt"/>
        <result column="A.lockLastPnttm" property="ussMngr.lockLastPnttm"/>
        <result column="A.chgPwdLastPnttm" property="ussMngr.chgPwdLastPnttm"/>

    </resultMap>
    <select id="selectDetail" parameterType="com.intermorph.uss.mngr.service.IMUssMngrVO" resultMap="selectDetailResultMap">
        /* IMComtnemplyrinfoMapper.selectDetail */
SELECT 
       A.emplyr_id AS "A.emplyrId",
       A.orgnzt_id AS "A.orgnztId",
       A.user_nm AS "A.userNm",
       A.password AS "A.password",
       A.empl_no AS "A.emplNo",
       A.ihidnum AS "A.ihidnum",
       A.sexdstn_code AS "A.sexdstnCode",
       A.brthdy AS "A.brthdy",
       A.fxnum AS "A.fxnum",
       A.house_adres AS "A.houseAdres",
       A.password_hint AS "A.passwordHint",
       A.password_cnsr AS "A.passwordCnsr",
       A.house_end_telno AS "A.houseEndTelno",
       A.area_no AS "A.areaNo",
       A.detail_adres AS "A.detailAdres",
       A.zip AS "A.zip",
       A.offm_telno AS "A.offmTelno",
       A.mbtlnum AS "A.mbtlnum",
       A.email_adres AS "A.emailAdres",
       A.ofcps_nm AS "A.ofcpsNm",
       A.house_middle_telno AS "A.houseMiddleTelno",
       A.group_id AS "A.groupId",
       A.pstinst_code AS "A.pstinstCode",
       A.emplyr_sttus_code AS "A.emplyrSttusCode",
       A.esntl_id AS "A.esntlId",
       A.crtfc_dn_value AS "A.crtfcDnValue",
       TO_CHAR(A.sbscrb_de, 'yyyymmddhh24miss')   AS "A.sbscrbDe",
       A.lock_at AS "A.lockAt",
       A.lock_cnt AS "A.lockCnt",
       A.lock_last_pnttm AS "A.lockLastPnttm",
       A.chg_pwd_last_pnttm AS "A.chgPwdLastPnttm"
  
  FROM comtnemplyrinfo A
 WHERE
       esntl_id = #{esntlId}
    </select>


    <resultMap id="selectListResultMap" type="com.intermorph.uss.mngr.service.IMUssMngrResultSet">
        <result column="A.emplyrId" property="ussMngr.emplyrId"/>
        <result column="A.orgnztId" property="ussMngr.orgnztId"/>
        <result column="A.userNm" property="ussMngr.userNm"/>
        <result column="A.password" property="ussMngr.password"/>
        <result column="A.emplNo" property="ussMngr.emplNo"/>
        <result column="A.ihidnum" property="ussMngr.ihidnum"/>
        <result column="A.sexdstnCode" property="ussMngr.sexdstnCode"/>
        <result column="A.brthdy" property="ussMngr.brthdy"/>
        <result column="A.fxnum" property="ussMngr.fxnum"/>
        <result column="A.houseAdres" property="ussMngr.houseAdres"/>
        <result column="A.passwordHint" property="ussMngr.passwordHint"/>
        <result column="A.passwordCnsr" property="ussMngr.passwordCnsr"/>
        <result column="A.houseEndTelno" property="ussMngr.houseEndTelno"/>
        <result column="A.areaNo" property="ussMngr.areaNo"/>
        <result column="A.detailAdres" property="ussMngr.detailAdres"/>
        <result column="A.zip" property="ussMngr.zip"/>
        <result column="A.offmTelno" property="ussMngr.offmTelno"/>
        <result column="A.mbtlnum" property="ussMngr.mbtlnum"/>
        <result column="A.emailAdres" property="ussMngr.emailAdres"/>
        <result column="A.ofcpsNm" property="ussMngr.ofcpsNm"/>
        <result column="A.houseMiddleTelno" property="ussMngr.houseMiddleTelno"/>
        <result column="A.groupId" property="ussMngr.groupId"/>
        <result column="A.pstinstCode" property="ussMngr.pstinstCode"/>
        <result column="A.emplyrSttusCode" property="ussMngr.emplyrSttusCode"/>
        <result column="A.esntlId" property="ussMngr.esntlId"/>
        <result column="A.crtfcDnValue" property="ussMngr.crtfcDnValue"/>
        <result column="A.sbscrbDe" property="ussMngr.sbscrbDe"/>
        <result column="A.lockAt" property="ussMngr.lockAt"/>
        <result column="A.lockCnt" property="ussMngr.lockCnt"/>
        <result column="A.lockLastPnttm" property="ussMngr.lockLastPnttm"/>
        <result column="A.chgPwdLastPnttm" property="ussMngr.chgPwdLastPnttm"/>
        <result column="E.agncyNm" property="agncy.agncyNm"/>

    </resultMap>
    <select id="selectList" parameterType="com.intermorph.uss.mngr.service.IMUssMngrCondition" resultMap="selectListResultMap">
/* IMComtnemplyrinfoMapper.selectList */
         <if test='currentPageNo != 0'>
SELECT * FROM ( SELECT rownum rn, TB.* FROM (
        </if>
SELECT
       A.emplyr_id AS "A.emplyrId",
       A.orgnzt_id AS "A.orgnztId",
       A.user_nm AS "A.userNm",
       A.password AS "A.password",
       A.empl_no AS "A.emplNo",
       A.ihidnum AS "A.ihidnum",
       A.sexdstn_code AS "A.sexdstnCode",
       A.brthdy AS "A.brthdy",
       A.fxnum AS "A.fxnum",
       A.house_adres AS "A.houseAdres",
       A.password_hint AS "A.passwordHint",
       A.password_cnsr AS "A.passwordCnsr",
       A.house_end_telno AS "A.houseEndTelno",
       A.area_no AS "A.areaNo",
       A.detail_adres AS "A.detailAdres",
       A.zip AS "A.zip",
       A.offm_telno AS "A.offmTelno",
       A.mbtlnum AS "A.mbtlnum",
       A.email_adres AS "A.emailAdres",
       A.ofcps_nm AS "A.ofcpsNm",
       A.house_middle_telno AS "A.houseMiddleTelno",
       A.group_id AS "A.groupId",
       A.pstinst_code AS "A.pstinstCode",
       A.emplyr_sttus_code AS "A.emplyrSttusCode",
       A.esntl_id AS "A.esntlId",
       A.crtfc_dn_value AS "A.crtfcDnValue",
       TO_CHAR(A.sbscrb_de, 'yyyymmddhh24miss')   AS "A.sbscrbDe",
       A.lock_at AS "A.lockAt",
       A.lock_cnt AS "A.lockCnt",
       A.lock_last_pnttm AS "A.lockLastPnttm",
       A.chg_pwd_last_pnttm AS "A.chgPwdLastPnttm",
       E.agncy_nm AS "E.agncyNm"

  FROM comtnemplyrinfo A  
  LEFT OUTER JOIN im_agncy E ON A.group_id=E.agncy_id  
  
 WHERE A.emplyr_sttus_code != 'D'
 
 AND EXISTS ( SELECT 1 FROM COMTNEMPLYRSCRTYESTBS z WHERE z.author_code=#{scAuthorCodeUpper} AND A.esntl_id=Z.scrty_dtrmn_trget_id  )
 
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("emplyrId")'>
       			AND A.emplyr_id LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("userNm")'>
       			AND A.user_nm LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("emailAdres")'>
       			AND A.email_adres LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("telno")'>
       			AND CONCAT(A.area_no,A.house_middle_telno,A.house_end_telno) LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
        <if test='scEmplyrSttusCode != null and !scEmplyrSttusCode.equals("")'>
       			AND A.emplyr_sttus_code = #{scEmplyrSttusCode}
        </if>
        <if test='scAgncyId != null and !scAgncyId.equals("")'>
       			AND A.group_id = #{scAgncyId}
        </if>
 
  		<choose>
            <when test='orderbyKey == 1'>ORDER BY A.sbscrb_de ASC</when>
            <when test='orderbyKey == -1'>ORDER BY A.sbscrb_de DESC</when>
            <otherwise>ORDER BY A.sbscrb_de DESC</otherwise>
        </choose>

        <if test='currentPageNo != 0'>
        ) TB ) WHERE rn BETWEEN #{firstItemNo}+1  AND #{firstItemNo} + #{recordCountPerPage}
        </if>
    </select>

    <select id="selectListCount" parameterType="com.intermorph.uss.mngr.service.IMUssMngrCondition" resultType="int">
/* IMComtnemplyrinfoMapper.selectListCount */
SELECT COUNT(*) 
  FROM comtnemplyrinfo A  
  LEFT OUTER JOIN im_agncy E ON A.group_id=E.agncy_id  
 WHERE A.emplyr_sttus_code != 'D' 
 		AND EXISTS ( SELECT 1 FROM COMTNEMPLYRSCRTYESTBS z WHERE z.author_code=#{scAuthorCodeUpper} AND A.esntl_id=Z.scrty_dtrmn_trget_id  )
 		
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("emplyrId")'>
       			AND A.emplyr_id LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("userNm")'>
       			AND A.user_nm LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("emailAdres")'>
       			AND A.email_adres LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("telno")'>
       			AND CONCAT(A.area_no,A.house_middle_telno,A.house_end_telno) LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
        <if test='scEmplyrSttusCode != null and !scEmplyrSttusCode.equals("")'>
       			AND A.emplyr_sttus_code = #{scEmplyrSttusCode}
        </if>
        <if test='scAgncyId != null and !scAgncyId.equals("")'>
       			AND A.group_id = #{scAgncyId}
        </if>
    </select>
    
    
    <update id="delete" parameterType="com.intermorph.uss.mngr.service.IMUssMngrVO">
/* IMComtnemplyrinfoMapper.delete*/
UPDATE comtnemplyrinfo 
   SET 
       emplyr_sttus_code = 'D' 
 WHERE 
		esntl_id = #{esntlId}
    </update>
</mapper>