<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.intermorph.uss.issu.service.IMIssuAplyMapper">

    <insert id="insert" parameterType="com.intermorph.uss.issu.service.IMIssuAplyVO" useGeneratedKeys="false">
/* IMIssuAplyMapper.insert */
INSERT INTO im_issu_aply (
    issu_aply_id,
    esntl_id,
    issu_dvsn_cdv,
    qlfc_rslt_code,
    brdt,
    mmbr_id,
    mber_nm,
    mmbr_telno,
    agncy_id,
    crs_grd_cdv,
    edu_bgn_dt,
    edu_end_dt,
    lcnc_acqs_ymd,
    zipc,
    addr,
    addr_dtl,
    issu_rsn,
    rrno,
    evddoc_id,
    fmly_evddoc_id,
    stts_cdv,
	
	<if test='sttsCdv != null and !sttsCdv.equals("")'>
 			<if test='sttsCdv.equals("01")'>
 			aply_ymd,
 			</if>
 			<if test='sttsCdv.equals("02")'>
 			aply_ymd,
 			idnty_ymd,
 			</if>
 	</if>
	
    del_yn,
    frst_reger_id,
    frst_reg_dt,
    frst_reger_ip
) VALUES (
    #{issuAplyId, jdbcType=VARCHAR},
    #{esntlId, jdbcType=VARCHAR},
    #{issuDvsnCdv, jdbcType=VARCHAR},
    #{qlfcRsltCode, jdbcType=VARCHAR},
    #{brdt, jdbcType=VARCHAR},
    #{mmbrId, jdbcType=VARCHAR},
    #{mberNm, jdbcType=VARCHAR},
    #{mmbrTelnoDB, jdbcType=VARCHAR},
    #{agncyId, jdbcType=VARCHAR},
    #{crsGrdCdv, jdbcType=VARCHAR},
    #{eduBgnDt, jdbcType=VARCHAR},
    #{eduEndDt, jdbcType=VARCHAR},
    #{lcncAcqsYmd, jdbcType=VARCHAR},
    #{zipc, jdbcType=VARCHAR},
    #{addr, jdbcType=VARCHAR},
    #{addrDtl, jdbcType=VARCHAR},
    #{issuRsn, jdbcType=VARCHAR},
    enc_b64(USER, 'KEY1', #{rrnoDB, jdbcType=VARCHAR}),
    #{evddocId, jdbcType=VARCHAR},
    #{fmlyEvddocId, jdbcType=VARCHAR},
    #{sttsCdv, jdbcType=VARCHAR},
    
    <if test='sttsCdv != null and !sttsCdv.equals("")'>
 			<if test='sttsCdv.equals("01")'>
 		 TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
 			</if>
 			<if test='sttsCdv.equals("02")'>
 			TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
 			TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
    		</if>
 	</if>
    
     'N',
     
    #{frstRegerId, jdbcType=VARCHAR},
    TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
    #{frstRegerIp, jdbcType=VARCHAR}
) 
    </insert>

    <update id="update" parameterType="com.intermorph.uss.issu.service.IMIssuAplyVO">
/* IMIssuAplyMapper.update */
UPDATE im_issu_aply
   SET 
   		
        <if test='brdt != null'>
         brdt = #{brdt, jdbcType=VARCHAR},
        </if>
        <if test='mmbrTelno != null'>
       mmbr_telno = #{mmbrTelno, jdbcType=VARCHAR},
       </if>
       <if test='agncyId != null'>
       agncy_id = #{agncyId, jdbcType=VARCHAR},
       </if>
       <if test='eduBgnDt != null'>
       edu_bgn_dt = #{eduBgnDt, jdbcType=VARCHAR},
       </if>
       <if test='eduEndDt != null'>
       edu_end_dt = #{eduEndDt, jdbcType=VARCHAR},
       </if>
        <if test='zipc != null'>
       zipc = #{zipc, jdbcType=VARCHAR},
       </if>
       <if test='addr != null'>
       addr = #{addr, jdbcType=VARCHAR},
       </if>
       <if test='addrDtl != null'>
       addr_dtl = #{addrDtl, jdbcType=VARCHAR},
       </if>
       <if test='issuRsn != null'>
       issu_rsn = #{issuRsn, jdbcType=VARCHAR},
       </if>
       <if test='rrno1 != null'>
       rrno = enc_b64(USER, 'KEY1', #{rrnoDB, jdbcType=VARCHAR}),
       </if>
       <if test='evddocId != null'>
       evddoc_id = #{evddocId, jdbcType=VARCHAR},
       </if>
       <if test='fmlyEvddocId != null'>
       fmly_evddoc_id = #{fmlyEvddocId, jdbcType=VARCHAR},
       </if>
       <if test='sttsCdv != null'>
       stts_cdv = #{sttsCdv, jdbcType=VARCHAR},
	       <if test='sttsCdv.equals("02")'>
	       lcnc_issu_code = #{lcncIssuCode, jdbcType=VARCHAR},
	       </if>
	       <if test='!sttsCdv.equals("02")'>
	       lcnc_issu_code = null,
	       </if>
       </if>
       <if test='prcsRmks != null'>
       prcs_rmks = #{prcsRmks, jdbcType=VARCHAR},
       </if>
		<if test='sttsCdv != null and !sttsCdv.equals("")'>
 			<if test='sttsCdv.equals("01")'>
 			aply_ymd = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
 			</if>
 			
 			<if test='sttsCdv.equals("02") or sttsCdv.equals("04")'>
 		 	idnty_ymd = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
 			</if>
 		</if>
	   last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR}
 WHERE
       issu_aply_id = #{issuAplyId}

   AND del_yn = 'N' 
    </update>

    <update id="delete" parameterType="com.intermorph.uss.issu.service.IMIssuAplyVO">
/* IMIssuAplyMapper.delete */
UPDATE im_issu_aply 
   SET last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR},
       del_yn = 'Y' 
 WHERE 
       issu_aply_id = #{issuAplyId}

   AND del_yn = 'N'
    </update>

    <resultMap id="selectDetailResultMap" type="com.intermorph.uss.issu.service.IMIssuAplyResultSet">
        <result column="A.issuAplyId" property="issuAply.issuAplyId"/>
        <result column="A.esntlId" property="issuAply.esntlId"/>
        <result column="A.issuDvsnCdv" property="issuAply.issuDvsnCdv"/>
        <result column="A.qlfcRsltCode" property="issuAply.qlfcRsltCode"/>
        <result column="A.lcncIssuCode" property="issuAply.lcncIssuCode"/>
        <result column="A.brdt" property="issuAply.brdt"/>
        <result column="A.mmbrId" property="issuAply.mmbrId"/>
        <result column="A.mberNm" property="issuAply.mberNm"/>
        <result column="A.mmbrTelno" property="issuAply.mmbrTelno"/>
        <result column="A.agncyId" property="issuAply.agncyId"/>
        <result column="A.crsGrdCdv" property="issuAply.crsGrdCdv"/>
        <result column="A.eduBgnDt" property="issuAply.eduBgnDt"/>
        <result column="A.eduEndDt" property="issuAply.eduEndDt"/>
        <result column="A.lcncAcqsYmd" property="issuAply.lcncAcqsYmd"/>
        <result column="A.zipc" property="issuAply.zipc"/>
        <result column="A.addr" property="issuAply.addr"/>
        <result column="A.addrDtl" property="issuAply.addrDtl"/>
        <result column="A.issuRsn" property="issuAply.issuRsn"/>
        <result column="A.rrno" property="issuAply.rrno"/>
        <result column="A.evddocId" property="issuAply.evddocId"/>
        <result column="A.fmlyEvddocId" property="issuAply.fmlyEvddocId"/>
        <result column="A.sttsCdv" property="issuAply.sttsCdv"/>
        <result column="A.aplyYmd" property="issuAply.aplyYmd"/>
        <result column="A.idntyYmd" property="issuAply.idntyYmd"/>
        <result column="A.prcsRmks" property="issuAply.prcsRmks"/>
        <result column="A.delYn" property="issuAply.delYn"/>
        <result column="A.frstRegerId" property="issuAply.frstRegerId"/>
        <result column="A.frstRegDt" property="issuAply.frstRegDt"/>
        <result column="A.frstRegerIp" property="issuAply.frstRegerIp"/>
        <result column="A.lastMdferId" property="issuAply.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="issuAply.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="issuAply.lastMdferIp"/>
        <result column="B.agncyId" property="agncy.agncyId"/>
        <result column="B.agncyNm" property="agncy.agncyNm"/>

    </resultMap>
    <select id="selectDetail" parameterType="com.intermorph.uss.issu.service.IMIssuAplyVO" resultMap="selectDetailResultMap">
        /* IMIssuAplyMapper.selectDetail */
SELECT 
       A.issu_aply_id AS "A.issuAplyId",
       A.esntl_id AS "A.esntlId",
       A.issu_dvsn_cdv AS "A.issuDvsnCdv",
       A.lcnc_issu_code AS "A.lcncIssuCode",
       A.qlfc_rslt_code AS "A.qlfcRsltCode",
       A.brdt AS "A.brdt",
       A.mmbr_id AS "A.mmbrId",
       A.mber_nm AS "A.mberNm",
       A.mmbr_telno AS "A.mmbrTelno",
       A.agncy_id AS "A.agncyId",
       A.crs_grd_cdv AS "A.crsGrdCdv",
       A.edu_bgn_dt AS "A.eduBgnDt",
       A.edu_end_dt AS "A.eduEndDt",
       A.lcnc_acqs_ymd AS "A.lcncAcqsYmd",
       A.zipc AS "A.zipc",
       A.addr AS "A.addr",
       A.addr_dtl AS "A.addrDtl",
       A.issu_rsn AS "A.issuRsn",
       dec_b64(USER, 'KEY1',A.rrno) AS "A.rrno",
       A.evddoc_id AS "A.evddocId",
       A.fmly_evddoc_id AS "A.fmlyEvddocId",
       A.stts_cdv AS "A.sttsCdv",
       A.aply_ymd AS "A.aplyYmd",
       A.idnty_ymd AS "A.idntyYmd",
       A.prcs_rmks AS "A.prcsRmks",
       A.del_yn AS "A.delYn",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp",
       B.agncy_id AS "B.agncyId",
       B.agncy_nm AS "B.agncyNm"
  
  FROM im_issu_aply A
  INNER JOIN im_agncy B ON A.agncy_id=B.agncy_id
 WHERE
       issu_aply_id = #{issuAplyId}

   AND A.del_yn = 'N'
    </select>


    <resultMap id="selectListResultMap" type="com.intermorph.uss.issu.service.IMIssuAplyResultSet">
        <result column="A.issuAplyId" property="issuAply.issuAplyId"/>
        <result column="A.esntlId" property="issuAply.esntlId"/>
        <result column="A.issuDvsnCdv" property="issuAply.issuDvsnCdv"/>
        <result column="A.qlfcRsltCode" property="issuAply.qlfcRsltCode"/>
        <result column="A.lcncIssuCode" property="issuAply.lcncIssuCode"/>
        <result column="A.brdt" property="issuAply.brdt"/>
        <result column="A.mmbrId" property="issuAply.mmbrId"/>
        <result column="A.mberNm" property="issuAply.mberNm"/>
        <result column="A.mmbrTelno" property="issuAply.mmbrTelno"/>
        <result column="A.agncyId" property="issuAply.agncyId"/>
        <result column="A.crsGrdCdv" property="issuAply.crsGrdCdv"/>
        <result column="A.eduBgnDt" property="issuAply.eduBgnDt"/>
        <result column="A.eduEndDt" property="issuAply.eduEndDt"/>
        <result column="A.lcncAcqsYmd" property="issuAply.lcncAcqsYmd"/>
        <result column="A.zipc" property="issuAply.zipc"/>
        <result column="A.addr" property="issuAply.addr"/>
        <result column="A.addrDtl" property="issuAply.addrDtl"/>
        <result column="A.issuRsn" property="issuAply.issuRsn"/>
        <result column="A.rrno" property="issuAply.rrno"/>
        <result column="A.evddocId" property="issuAply.evddocId"/>
        <result column="A.fmlyEvddocId" property="issuAply.fmlyEvddocId"/>
        <result column="A.sttsCdv" property="issuAply.sttsCdv"/>
        <result column="A.aplyYmd" property="issuAply.aplyYmd"/>
        <result column="A.idntyYmd" property="issuAply.idntyYmd"/>
        <result column="A.prcsRmks" property="issuAply.prcsRmks"/>
        <result column="A.delYn" property="issuAply.delYn"/>
        <result column="A.frstRegerId" property="issuAply.frstRegerId"/>
        <result column="A.frstRegDt" property="issuAply.frstRegDt"/>
        <result column="A.frstRegerIp" property="issuAply.frstRegerIp"/>
        <result column="A.lastMdferId" property="issuAply.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="issuAply.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="issuAply.lastMdferIp"/>
        <result column="B.agncyId" property="agncy.agncyId"/>
        <result column="B.agncyNm" property="agncy.agncyNm"/>

    </resultMap>
    <select id="selectList" parameterType="com.intermorph.uss.issu.service.IMIssuAplyCondition" resultMap="selectListResultMap">
/* IMIssuAplyMapper.selectList */
         <if test='currentPageNo != 0'>
SELECT * FROM ( SELECT rownum rn, TB.* FROM (
        </if>
SELECT
       A.issu_aply_id AS "A.issuAplyId",
       A.esntl_id AS "A.esntlId",
       A.issu_dvsn_cdv AS "A.issuDvsnCdv",
       A.qlfc_rslt_code AS "A.qlfcRsltCode",
       A.lcnc_issu_code AS "A.lcncIssuCode",
       A.brdt AS "A.brdt",
       A.mmbr_id AS "A.mmbrId",
       A.mber_nm AS "A.mberNm",
       A.mmbr_telno AS "A.mmbrTelno",
       A.agncy_id AS "A.agncyId",
       A.crs_grd_cdv AS "A.crsGrdCdv",
       A.edu_bgn_dt AS "A.eduBgnDt",
       A.edu_end_dt AS "A.eduEndDt",
       A.lcnc_acqs_ymd AS "A.lcncAcqsYmd",
       A.zipc AS "A.zipc",
       A.addr AS "A.addr",
       A.addr_dtl AS "A.addrDtl",
       A.issu_rsn AS "A.issuRsn",
       dec_b64(USER, 'KEY1',A.rrno) AS "A.rrno",
       A.evddoc_id AS "A.evddocId",
       A.fmly_evddoc_id AS "A.fmlyEvddocId",
       A.stts_cdv AS "A.sttsCdv",
       A.aply_ymd AS "A.aplyYmd",
       A.idnty_ymd AS "A.idntyYmd",
       A.prcs_rmks AS "A.prcsRmks",
       A.del_yn AS "A.delYn",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp",
       B.agncy_id AS "B.agncyId",
       B.agncy_nm AS "B.agncyNm"

  FROM im_issu_aply A
  INNER JOIN im_agncy B ON A.agncy_id=B.agncy_id
 WHERE A.del_yn = 'N'
 <if test='scWord != null and !scWord.equals("")'>
    <if test='scKey.equals("mmbrId")'>
		AND A.mmbr_id LIKE CONCAT('%', #{scWord}, '%')
    </if>
    <if test='scKey.equals("mberNm")'>
		AND A.mber_nm LIKE CONCAT('%', #{scWord}, '%')
    </if>
    <if test='scKey.equals("mmbrTelno")'>
		AND A.mmbr_telno LIKE CONCAT('%', #{scWord}, '%')
    </if>
</if>
 <if test='scEsntlId != null and !scEsntlId.equals("")'>
	 AND A.esntl_id  =#{scEsntlId} 
 </if> 			
 <if test='scAgncyId != null and !scAgncyId.equals("")'>
	 AND A.agncy_id  =#{scAgncyId} 
 </if> 			
 
 <if test='scNotSttsCdv != null and !scNotSttsCdv.equals("")'>
 			<choose>
	            <when test='scNotSttsCdv.equals("9903")'>
	            		AND A.stts_cdv NOT IN ('99','03')
	            </when>
	            <otherwise>
	            	AND A.stts_cdv  !=#{scNotSttsCdv}
	            </otherwise>
        	</choose>
	  
 </if> 			
 
 <if test='scSttsCdv != null and !scSttsCdv.equals("")'>
	 AND A.stts_cdv  =#{scSttsCdv} 
 </if> 		
 
 
 <if test='scIssuDvsnCdv != null and !scIssuDvsnCdv.equals("")'>
	 AND A.issu_dvsn_cdv  =#{scIssuDvsnCdv} 
 </if> 		
 
 <if test='scEduYear != null and !scEduYear.equals("")'>
	 AND A.lcnc_acqs_ymd  LIKE CONCAT (#{scEduYear}, '%')
 </if> 		
 
 <if test='scCrsGrdCdv != null and !scCrsGrdCdv.equals("")'>
	 AND A.crs_grd_cdv  = #{scCrsGrdCdv}
 </if> 		
 
 
 	
 
 
  		<choose>
            <when test='orderbyKey == 5'>ORDER BY A.idnty_ymd ASC</when>
            <when test='orderbyKey == -5'>ORDER BY A.idnty_ymd DESC</when>
            <when test='orderbyKey == 4'>ORDER BY A.aply_ymd ASC</when>
            <when test='orderbyKey == -4'>ORDER BY A.aply_ymd DESC</when>
            <when test='orderbyKey == 3'>ORDER BY A.mber_nm ASC</when>
            <when test='orderbyKey == -3'>ORDER BY A.mber_nm DESC</when>
            <when test='orderbyKey == 2'>ORDER BY A.mmbr_id ASC</when>
            <when test='orderbyKey == -2'>ORDER BY A.mmbr_id DESC</when>
            <when test='orderbyKey == 1'>ORDER BY A.frst_reg_dt ASC</when>
            <when test='orderbyKey == -1'>ORDER BY A.frst_reg_dt DESC</when>
            <otherwise>ORDER BY A.frst_reg_dt DESC</otherwise>
        </choose>

        <if test='currentPageNo != 0'>
        ) TB ) WHERE rn BETWEEN #{firstItemNo}+1  AND #{firstItemNo} + #{recordCountPerPage}
        </if>
    </select>

    <select id="selectListCount" parameterType="com.intermorph.uss.issu.service.IMIssuAplyCondition" resultType="int">
/* IMIssuAplyMapper.selectListCount */
SELECT COUNT(*) 
  FROM im_issu_aply A
  INNER JOIN im_agncy B ON A.agncy_id=B.agncy_id
 WHERE A.del_yn = 'N'  
 <if test='scWord != null and !scWord.equals("")'>
    <if test='scKey.equals("mmbrId")'>
		AND A.mmbr_id LIKE CONCAT('%', #{scWord}, '%')
    </if>
    <if test='scKey.equals("mberNm")'>
		AND A.mber_nm LIKE CONCAT('%', #{scWord}, '%')
    </if>
    <if test='scKey.equals("mmbrTelno")'>
		AND A.mmbr_telno LIKE CONCAT('%', #{scWord}, '%')
    </if>
</if>
 <if test='scEsntlId != null and !scEsntlId.equals("")'>
	 AND A.esntl_id  =#{scEsntlId} 
 </if> 		
  			
 <if test='scAgncyId != null and !scAgncyId.equals("")'>
	 AND A.agncy_id  =#{scAgncyId} 
 </if> 
 
 <if test='scNotSttsCdv != null and !scNotSttsCdv.equals("")'>
 			<choose>
	            <when test='scNotSttsCdv.equals("9903")'>
	            		AND A.stts_cdv NOT IN ('99','03')
	            </when>
	            <otherwise>
	            	AND A.stts_cdv  !=#{scNotSttsCdv}
	            </otherwise>
        	</choose>
	  
 </if> 			 			
 
 <if test='scSttsCdv != null and !scSttsCdv.equals("")'>
	 AND A.stts_cdv  =#{scSttsCdv} 
 </if> 
 
 
 <if test='scIssuDvsnCdv != null and !scIssuDvsnCdv.equals("")'>
	 AND A.issu_dvsn_cdv  =#{scIssuDvsnCdv} 
 </if> 		
 
 <if test='scEduYear != null and !scEduYear.equals("")'>
	 AND A.lcnc_acqs_ymd  LIKE CONCAT (#{scEduYear}, '%')
 </if> 		
 
 <if test='scCrsGrdCdv != null and !scCrsGrdCdv.equals("")'>
	 AND A.crs_grd_cdv  = #{scCrsGrdCdv}
 </if> 						
    </select>
</mapper>