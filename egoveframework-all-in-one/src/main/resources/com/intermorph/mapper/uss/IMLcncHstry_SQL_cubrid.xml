<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.intermorph.uss.qlfc.service.IMLcncHstryMapper">

    <insert id="insert" parameterType="com.intermorph.uss.qlfc.service.IMLcncHstryVO" useGeneratedKeys="false">
/* IMLcncHstryMapper.insert */
INSERT INTO im_lcnc_hstry (
    lcnc_hstry_id,
    lcnc_no,
    acqs_year,
    lcnc_rslt_code,
    crs_grd,
    lcnc_acqs_dt,
    sexdstn,
    rgn,
    area,
    dtl_area,
    brdt,
    agncy_nm,
    mmbr_nm,
    telno,
    eml,
    yn_2018,
    yn_2019,
    yn_2020,
    yn_2021,
    yn_2022,
    agncy_code,
    bgn_dt,
    end_dt,
    cntnedu_cnt,
	lcnc_end_ymd,
    del_yn,
    frst_reger_id,
    frst_reg_dt,
    frst_reger_ip
) VALUES (
    #{lcncHstryId, jdbcType=VARCHAR},
    #{lcncNo, jdbcType=VARCHAR},
    #{acqsYear, jdbcType=VARCHAR},
    #{lcncRsltCode, jdbcType=VARCHAR},
    #{crsGrd, jdbcType=VARCHAR},
    #{lcncAcqsDt, jdbcType=VARCHAR},
    #{sexdstn, jdbcType=VARCHAR},
    #{rgn, jdbcType=VARCHAR},
    #{area, jdbcType=VARCHAR},
    #{dtlArea, jdbcType=VARCHAR},
    #{brdt, jdbcType=VARCHAR},
    #{agncyNm, jdbcType=VARCHAR},
    #{mmbrNm, jdbcType=VARCHAR},
    #{telno, jdbcType=VARCHAR},
    #{eml, jdbcType=VARCHAR},
    #{yn_2018, jdbcType=VARCHAR},
    #{yn_2019, jdbcType=VARCHAR},
    #{yn_2020, jdbcType=VARCHAR},
    #{yn_2021, jdbcType=VARCHAR},
    #{yn_2022, jdbcType=VARCHAR},
    #{agncyCode, jdbcType=VARCHAR},
    #{bgnDt, jdbcType=VARCHAR},
    #{endDt, jdbcType=VARCHAR},
    #{cntneduCnt, jdbcType=VARCHAR},
    #{lcncEndYmd, jdbcType=VARCHAR},

     'N',
    #{frstRegerId, jdbcType=VARCHAR},
    TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
    #{frstRegerIp, jdbcType=VARCHAR}
) 
    </insert>

    <update id="update" parameterType="com.intermorph.uss.qlfc.service.IMLcncHstryVO">
/* IMLcncHstryMapper.update */
UPDATE im_lcnc_hstry
   SET 
       lcnc_hstry_id = #{lcncHstryId, jdbcType=VARCHAR},
       lcnc_no = #{lcncNo, jdbcType=VARCHAR},
       acqs_year = #{acqsYear, jdbcType=VARCHAR},
       lcnc_rslt_code = #{lcncRsltCode, jdbcType=VARCHAR},
       crs_grd = #{crsGrd, jdbcType=VARCHAR},
       lcnc_acqs_dt = #{lcncAcqsDt, jdbcType=VARCHAR},
       sexdstn = #{sexdstn, jdbcType=VARCHAR},
       rgn = #{rgn, jdbcType=VARCHAR},
       area = #{area, jdbcType=VARCHAR},
       dtl_area = #{dtlArea, jdbcType=VARCHAR},
       brdt = #{brdt, jdbcType=VARCHAR},
       agncy_nm = #{agncyNm, jdbcType=VARCHAR},
       mmbr_nm = #{mmbrNm, jdbcType=VARCHAR},
       telno = #{telno, jdbcType=VARCHAR},
       eml = #{eml, jdbcType=VARCHAR},
       yn_2018 = #{yn_2018, jdbcType=VARCHAR},
       yn_2019 = #{yn_2019, jdbcType=VARCHAR},
       yn_2020 = #{yn_2020, jdbcType=VARCHAR},
       yn_2021 = #{yn_2021, jdbcType=VARCHAR},
       yn_2022 = #{yn_2022, jdbcType=VARCHAR},
       agncy_code = #{agncyCode, jdbcType=VARCHAR},
       bgn_dt = #{bgnDt, jdbcType=VARCHAR},
       end_dt = #{endDt, jdbcType=VARCHAR},
       cntnedu_cnt = #{cntneduCnt, jdbcType=VARCHAR},
		lcnc_end_ymd  = #{lcncEndYmd, jdbcType=VARCHAR},
	   last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR}
 WHERE
       lcnc_hstry_id = #{lcncHstryId}

   AND del_yn = 'N' 
    </update>

    <update id="delete" parameterType="com.intermorph.uss.qlfc.service.IMLcncHstryVO">
/* IMLcncHstryMapper.delete */
UPDATE im_lcnc_hstry 
   SET last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR},
       del_yn = 'Y' 
 WHERE 
       lcnc_hstry_id = #{lcncHstryId}

   AND del_yn = 'N'
    </update>
    <delete id="drop" parameterType="com.intermorph.uss.qlfc.service.IMLcncHstryVO">
/* IMLcncHstryMapper.drop */
delete  from im_lcnc_hstry WHERE   lcnc_no = #{lcncNo}
    </delete>

    <resultMap id="selectDetailResultMap" type="com.intermorph.uss.qlfc.service.IMLcncHstryResultSet">
        <result column="A.lcncHstryId" property="lcncHstry.lcncHstryId"/>
        <result column="A.lcncNo" property="lcncHstry.lcncNo"/>
        <result column="A.acqsYear" property="lcncHstry.acqsYear"/>
        <result column="A.lcncRsltCode" property="lcncHstry.lcncRsltCode"/>
        <result column="A.crsGrd" property="lcncHstry.crsGrd"/>
        <result column="A.lcncAcqsDt" property="lcncHstry.lcncAcqsDt"/>
        <result column="A.sexdstn" property="lcncHstry.sexdstn"/>
        <result column="A.rgn" property="lcncHstry.rgn"/>
        <result column="A.area" property="lcncHstry.area"/>
        <result column="A.dtlArea" property="lcncHstry.dtlArea"/>
        <result column="A.brdt" property="lcncHstry.brdt"/>
        <result column="A.agncyNm" property="lcncHstry.agncyNm"/>
        <result column="A.mmbrNm" property="lcncHstry.mmbrNm"/>
        <result column="A.telno" property="lcncHstry.telno"/>
        <result column="A.eml" property="lcncHstry.eml"/>
        <result column="A.yn_2018" property="lcncHstry.yn_2018"/>
        <result column="A.yn_2019" property="lcncHstry.yn_2019"/>
        <result column="A.yn_2020" property="lcncHstry.yn_2020"/>
        <result column="A.yn_2021" property="lcncHstry.yn_2021"/>
        <result column="A.yn_2022" property="lcncHstry.yn_2022"/>
        <result column="A.agncyCode" property="lcncHstry.agncyCode"/>
        <result column="A.bgnDt" property="lcncHstry.bgnDt"/>
        <result column="A.endDt" property="lcncHstry.endDt"/>
        <result column="A.cntneduCnt" property="lcncHstry.cntneduCnt"/>
        <result column="A.frstRegerId" property="lcncHstry.frstRegerId"/>
        <result column="A.frstRegDt" property="lcncHstry.frstRegDt"/>
        <result column="A.frstRegerIp" property="lcncHstry.frstRegerIp"/>
        <result column="A.lastMdferId" property="lcncHstry.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="lcncHstry.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="lcncHstry.lastMdferIp"/>

    </resultMap>
    <select id="selectDetail" parameterType="com.intermorph.uss.qlfc.service.IMLcncHstryVO" resultMap="selectDetailResultMap">
        /* IMLcncHstryMapper.selectDetail */
SELECT 
       A.lcnc_hstry_id AS "A.lcncHstryId",
       A.lcnc_no AS "A.lcncNo",
       A.acqs_year AS "A.acqsYear",
       A.lcnc_rslt_code AS "A.lcncRsltCode",
       A.crs_grd AS "A.crsGrd",
       A.lcnc_acqs_dt AS "A.lcncAcqsDt",
       A.sexdstn AS "A.sexdstn",
       A.rgn AS "A.rgn",
       A.area AS "A.area",
       A.dtl_area AS "A.dtlArea",
       A.brdt AS "A.brdt",
       A.agncy_nm AS "A.agncyNm",
       A.mmbr_nm AS "A.mmbrNm",
       A.telno AS "A.telno",
       A.eml AS "A.eml",
       A.yn_2018 AS "A.yn_2018",
       A.yn_2019 AS "A.yn_2019",
       A.yn_2020 AS "A.yn_2020",
       A.yn_2021 AS "A.yn_2021",
       A.yn_2022 AS "A.yn_2022",
       A.agncy_code AS "A.agncyCode",
       A.bgn_dt AS "A.bgnDt",
       A.end_dt AS "A.endDt",
       A.cntnedu_cnt AS "A.cntneduCnt",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp"
  
  FROM im_lcnc_hstry A
 WHERE
       lcnc_hstry_id = #{lcncHstryId}

   AND A.del_yn = 'N'
    </select>


    <resultMap id="selectListResultMap" type="com.intermorph.uss.qlfc.service.IMLcncHstryResultSet">
        <result column="A.lcncHstryId" property="lcncHstry.lcncHstryId"/>
        <result column="A.lcncNo" property="lcncHstry.lcncNo"/>
        <result column="A.acqsYear" property="lcncHstry.acqsYear"/>
        <result column="A.lcncRsltCode" property="lcncHstry.lcncRsltCode"/>
        <result column="A.crsGrd" property="lcncHstry.crsGrd"/>
        <result column="A.lcncAcqsDt" property="lcncHstry.lcncAcqsDt"/>
        <result column="A.sexdstn" property="lcncHstry.sexdstn"/>
        <result column="A.rgn" property="lcncHstry.rgn"/>
        <result column="A.area" property="lcncHstry.area"/>
        <result column="A.dtlArea" property="lcncHstry.dtlArea"/>
        <result column="A.brdt" property="lcncHstry.brdt"/>
        <result column="A.agncyNm" property="lcncHstry.agncyNm"/>
        <result column="A.mmbrNm" property="lcncHstry.mmbrNm"/>
        <result column="A.telno" property="lcncHstry.telno"/>
        <result column="A.eml" property="lcncHstry.eml"/>
        <result column="A.yn_2018" property="lcncHstry.yn_2018"/>
        <result column="A.yn_2019" property="lcncHstry.yn_2019"/>
        <result column="A.yn_2020" property="lcncHstry.yn_2020"/>
        <result column="A.yn_2021" property="lcncHstry.yn_2021"/>
        <result column="A.yn_2022" property="lcncHstry.yn_2022"/>
        <result column="A.agncyCode" property="lcncHstry.agncyCode"/>
        <result column="A.bgnDt" property="lcncHstry.bgnDt"/>
        <result column="A.endDt" property="lcncHstry.endDt"/>
        <result column="A.lcncEndYmd" property="lcncHstry.lcncEndYmd"/>
        <result column="A.cntneduCnt" property="lcncHstry.cntneduCnt"/>
        <result column="A.frstRegerId" property="lcncHstry.frstRegerId"/>
        <result column="A.frstRegDt" property="lcncHstry.frstRegDt"/>
        <result column="A.frstRegerIp" property="lcncHstry.frstRegerIp"/>
        <result column="A.lastMdferId" property="lcncHstry.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="lcncHstry.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="lcncHstry.lastMdferIp"/>

    </resultMap>
    <select id="selectList" parameterType="com.intermorph.uss.qlfc.service.IMLcncHstryCondition" resultMap="selectListResultMap">
/* IMLcncHstryMapper.selectList */
         <if test='currentPageNo != 0'>
SELECT * FROM ( SELECT rownum rn, TB.* FROM (
        </if>
SELECT
       A.lcnc_hstry_id AS "A.lcncHstryId",
       A.lcnc_no AS "A.lcncNo",
       A.acqs_year AS "A.acqsYear",
       A.lcnc_rslt_code AS "A.lcncRsltCode",
       A.crs_grd AS "A.crsGrd",
       A.lcnc_acqs_dt AS "A.lcncAcqsDt",
       A.sexdstn AS "A.sexdstn",
       A.rgn AS "A.rgn",
       A.area AS "A.area",
       A.dtl_area AS "A.dtlArea",
       A.brdt AS "A.brdt",
       A.agncy_nm AS "A.agncyNm",
       A.mmbr_nm AS "A.mmbrNm",
       A.telno AS "A.telno",
       A.eml AS "A.eml",
       A.yn_2018 AS "A.yn_2018",
       A.yn_2019 AS "A.yn_2019",
       A.yn_2020 AS "A.yn_2020",
       A.yn_2021 AS "A.yn_2021",
       A.yn_2022 AS "A.yn_2022",
       A.agncy_code AS "A.agncyCode",
       A.bgn_dt AS "A.bgnDt",
       A.end_dt AS "A.endDt",
       A.cntnedu_cnt AS "A.cntneduCnt",
       A.lcnc_end_ymd AS "A.lcncEndYmd",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp"

  FROM im_lcnc_hstry A
 WHERE A.del_yn = 'N'
 		
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("lcncNo")'>
       			AND A.lcnc_no LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("mmbrNm")'>
       			AND A.mmbr_nm LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("lcncRsltCode")'>
       			AND A.lcnc_rslt_code LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
  		<choose>
            <when test='orderbyKey == 1'>ORDER BY A.lcnc_no ASC</when>
            <when test='orderbyKey == -1'>ORDER BY A.lcnc_no DESC</when>
            <otherwise>ORDER BY A.lcnc_no DESC</otherwise>
        </choose>

        <if test='currentPageNo != 0'>
        ) TB ) WHERE rn BETWEEN #{firstItemNo}+1  AND #{firstItemNo} + #{recordCountPerPage}
        </if>
    </select>

    <select id="selectListCount" parameterType="com.intermorph.uss.qlfc.service.IMLcncHstryCondition" resultType="int">
/* IMLcncHstryMapper.selectListCount */
SELECT COUNT(*) 
  FROM im_lcnc_hstry A
 WHERE A.del_yn = 'N'  
 
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("lcncNo")'>
       			AND A.lcnc_no LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("mmbrNm")'>
       			AND A.mmbr_nm LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("lcncRsltCode")'>
       			AND A.lcnc_rslt_code LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
    </select>
    
    
    <select id="selectListUser" parameterType="map" resultType="com.intermorph.uss.qlfc.service.IMLcncHstryVO">
	SELECT
	       A.lcnc_hstry_id AS "lcncHstryId",
	       A.lcnc_no AS "lcncNo",
	       A.acqs_year AS "acqsYear",
	       A.lcnc_rslt_code AS "lcncRsltCode",
	       A.crs_grd AS "crsGrd",
	       A.lcnc_acqs_dt AS "lcncAcqsDt",
	       A.sexdstn AS "sexdstn",
	       A.rgn AS "rgn",
	       A.area AS "area",
	       A.dtl_area AS "dtlArea",
	       A.brdt AS "brdt",
	       CASE 
	        WHEN A.lcnc_end_ymd is NOT NULL THEN CONCAT(A.lcnc_end_ymd,'235959')
	       	WHEN yn_2022='Y' THEN '20251231235959' 
	       	WHEN yn_2021='Y' THEN '20241231235959' 
	       	WHEN yn_2020='Y' THEN '20231231235959'
	       	WHEN yn_2019='Y' THEN '20221231235959'
	       	WHEN yn_2018='Y' THEN '20211231235959'
	       	ELSE   '20201231235959'
	       END AS "lcncEndYmd",
	       A.agncy_nm AS "agncyNm",
	       A.mmbr_nm AS "mmbrNm",
	       A.telno AS "telno",
	       A.eml AS "eml",
	       A.agncy_code AS "agncyCode",
	       A.bgn_dt AS "bgnDt",
	       A.end_dt AS "endDt",
	       A.cntnedu_cnt AS "cntneduCnt"
	
	  FROM im_lcnc_hstry A
	  
	  WHERE 
	  		A.del_yn = 'N'
	 		AND REPLACE(REPLACE(A.brdt,'-',''),'.','') = REPLACE(REPLACE(#{brdt},'-',''),'.','')
	 		AND mmbr_nm  =#{mmbrNm} 
    </select>
</mapper>