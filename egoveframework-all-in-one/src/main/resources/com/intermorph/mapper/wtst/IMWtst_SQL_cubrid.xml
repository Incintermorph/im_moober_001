<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.intermorph.wtst.wtst.service.IMWtstMapper">

    <insert id="insert" parameterType="com.intermorph.wtst.wtst.service.IMWtstVO" useGeneratedKeys="false">
/* IMWtstMapper.insert */
INSERT INTO im_wtst (
    wtst_id,
    crs_grd_cdv,
    edu_year,
    edu_rnd,
    tst_ymd,
    tst_bgng_hrs,
    tst_end_hrs,
    addtn_yn,
    tstfee,
    stts_cdv,

    del_yn,
    frst_reger_id,
    frst_reg_dt,
    frst_reger_ip
) VALUES (
    #{wtstId, jdbcType=VARCHAR},
    #{crsGrdCdv, jdbcType=VARCHAR},
    #{eduYear, jdbcType=VARCHAR},
    #{eduRnd, jdbcType=VARCHAR},
    #{tstYmd, jdbcType=VARCHAR},
    #{tstBgngHrs, jdbcType=VARCHAR},
    #{tstEndHrs, jdbcType=VARCHAR},
    #{addtnYn, jdbcType=VARCHAR},
    #{tstfee, jdbcType=VARCHAR},
    #{sttsCdv, jdbcType=VARCHAR},

     'N',
    #{frstRegerId, jdbcType=VARCHAR},
    TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
    #{frstRegerIp, jdbcType=VARCHAR}
) 
    </insert>

    <update id="update" parameterType="com.intermorph.wtst.wtst.service.IMWtstVO">
/* IMWtstMapper.update */
UPDATE im_wtst
   SET 
       wtst_id = #{wtstId, jdbcType=VARCHAR},
       crs_grd_cdv = #{crsGrdCdv, jdbcType=VARCHAR},
       edu_year = #{eduYear, jdbcType=VARCHAR},
       edu_rnd = #{eduRnd, jdbcType=VARCHAR},
       tst_ymd = #{tstYmd, jdbcType=VARCHAR},
       tst_bgng_hrs = #{tstBgngHrs, jdbcType=VARCHAR},
       tst_end_hrs = #{tstEndHrs, jdbcType=VARCHAR},
       addtn_yn = #{addtnYn, jdbcType=VARCHAR},
       tstfee = #{tstfee, jdbcType=VARCHAR},
       stts_cdv = #{sttsCdv, jdbcType=VARCHAR},

	   last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR}
 WHERE
       wtst_id = #{wtstId}

   AND del_yn = 'N' 
    </update>

    <update id="delete" parameterType="com.intermorph.wtst.wtst.service.IMWtstVO">
/* IMWtstMapper.delete */
UPDATE im_wtst 
   SET last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR},
       del_yn = 'Y' 
 WHERE 
       wtst_id = #{wtstId}

   AND del_yn = 'N'
    </update>

    <resultMap id="selectDetailResultMap" type="com.intermorph.wtst.wtst.service.IMWtstResultSet">
        <result column="A.wtstId" property="wtst.wtstId"/>
        <result column="A.crsGrdCdv" property="wtst.crsGrdCdv"/>
        <result column="A.eduYear" property="wtst.eduYear"/>
        <result column="A.eduRnd" property="wtst.eduRnd"/>
        <result column="A.tstYmd" property="wtst.tstYmd"/>
        <result column="A.tstBgngHrs" property="wtst.tstBgngHrs"/>
        <result column="A.tstEndHrs" property="wtst.tstEndHrs"/>
        <result column="A.addtnYn" property="wtst.addtnYn"/>
        <result column="A.tstfee" property="wtst.tstfee"/>
        <result column="A.sttsCdv" property="wtst.sttsCdv"/>
        <result column="A.delYn" property="wtst.delYn"/>
        <result column="A.frstRegerId" property="wtst.frstRegerId"/>
        <result column="A.frstRegDt" property="wtst.frstRegDt"/>
        <result column="A.frstRegerIp" property="wtst.frstRegerIp"/>
        <result column="A.lastMdferId" property="wtst.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="wtst.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="wtst.lastMdferIp"/>

    </resultMap>
    <select id="selectDetail" parameterType="com.intermorph.wtst.wtst.service.IMWtstVO" resultMap="selectDetailResultMap">
        /* IMWtstMapper.selectDetail */
SELECT 
       A.wtst_id AS "A.wtstId",
       A.crs_grd_cdv AS "A.crsGrdCdv",
       A.edu_year AS "A.eduYear",
       A.edu_rnd AS "A.eduRnd",
       A.tst_ymd AS "A.tstYmd",
       A.tst_bgng_hrs AS "A.tstBgngHrs",
       A.tst_end_hrs AS "A.tstEndHrs",
       A.addtn_yn AS "A.addtnYn",
       A.tstfee AS "A.tstfee",
       A.stts_cdv AS "A.sttsCdv",
       A.del_yn AS "A.delYn",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp"
  
  FROM im_wtst A
 WHERE
       wtst_id = #{wtstId}

   AND A.del_yn = 'N'
    </select>


    <resultMap id="selectListResultMap" type="com.intermorph.wtst.wtst.service.IMWtstResultSet">
        <result column="A.wtstId" property="wtst.wtstId"/>
        <result column="A.crsGrdCdv" property="wtst.crsGrdCdv"/>
        <result column="A.eduYear" property="wtst.eduYear"/>
        <result column="A.eduRnd" property="wtst.eduRnd"/>
        <result column="A.tstYmd" property="wtst.tstYmd"/>
        <result column="A.tstBgngHrs" property="wtst.tstBgngHrs"/>
        <result column="A.tstEndHrs" property="wtst.tstEndHrs"/>
        <result column="A.addtnYn" property="wtst.addtnYn"/>
        <result column="A.tstfee" property="wtst.tstfee"/>
        <result column="A.sttsCdv" property="wtst.sttsCdv"/>
        <result column="A.delYn" property="wtst.delYn"/>
        <result column="A.frstRegerId" property="wtst.frstRegerId"/>
        <result column="A.frstRegDt" property="wtst.frstRegDt"/>
        <result column="A.frstRegerIp" property="wtst.frstRegerIp"/>
        <result column="A.lastMdferId" property="wtst.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="wtst.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="wtst.lastMdferIp"/>
        
        
        <result column="A.pbancTerm_bgnDt" property="wtst.pbancTerm_bgnDt"/>
        <result column="A.pbancTerm_endDt" property="wtst.pbancTerm_endDt"/>
        <result column="A.rcptTerm_bgnDt" property="wtst.rcptTerm_bgnDt"/>
        <result column="A.rcptTerm_endDt" property="wtst.rcptTerm_endDt"/>
        <result column="A.passTerm_bgnDt" property="wtst.passTerm_bgnDt"/>
        <result column="A.passTerm_endDt" property="wtst.passTerm_endDt"/>
        <result column="placeCnt" property="placeCnt"/>

    </resultMap>
    <select id="selectList" parameterType="com.intermorph.wtst.wtst.service.IMWtstCondition" resultMap="selectListResultMap">
/* IMWtstMapper.selectList */
         <if test='currentPageNo != 0'>
SELECT * FROM ( SELECT rownum rn, TB.* FROM (
        </if>
SELECT
       A.wtst_id AS "A.wtstId",
       A.crs_grd_cdv AS "A.crsGrdCdv",
       A.edu_year AS "A.eduYear",
       A.edu_rnd AS "A.eduRnd",
       A.tst_ymd AS "A.tstYmd",
       A.tst_bgng_hrs AS "A.tstBgngHrs",
       A.tst_end_hrs AS "A.tstEndHrs",
       A.addtn_yn AS "A.addtnYn",
       A.tstfee AS "A.tstfee",
       A.stts_cdv AS "A.sttsCdv",
       A.del_yn AS "A.delYn",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp",
       B.bgn_dt AS "A.pbancTerm_bgnDt" ,
       B.end_dt AS "A.pbancTerm_endDt" ,       
       C.bgn_dt AS "A.rcptTerm_bgnDt" ,
       C.end_dt AS "A.rcptTerm_endDt" ,       
       D.bgn_dt AS "A.passTerm_bgnDt" ,
       D.end_dt AS "A.passTerm_endDt" ,
       (SELECT COUNT(*) FROM im_wtst_place WHERE wtst_id=A.wtst_id AND del_yn='N') placeCnt

  FROM im_wtst A
  INNER JOIN im_cmmn_dt B ON A.wtst_id=B.tbl_ref_id AND B.tbl_id='IM_WTST' AND B.ref_nm='pbancTerm'
  INNER JOIN im_cmmn_dt C ON A.wtst_id=C.tbl_ref_id AND C.tbl_id='IM_WTST' AND C.ref_nm='rcptTerm'
  INNER JOIN im_cmmn_dt D ON A.wtst_id=D.tbl_ref_id AND D.tbl_id='IM_WTST' AND D.ref_nm='passTerm'
 WHERE A.del_yn = 'N'
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("wtstId")'>
       			AND A.wtst_id LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
        
         <if test='scCrsGrdCdv != null and !scCrsGrdCdv.equals("")'>
       			AND A.crs_grd_cdv = #{scCrsGrdCdv}
        </if>
        <if test='scSttsCdv != null and !scSttsCdv.equals("")'>
       			AND A.stts_cdv = #{scSttsCdv}
        </if>
        <if test='scEduYear != null and !scEduYear.equals("")'>
       			AND A.edu_year = #{scEduYear}
        </if>
        <if test='scEduRnd != null and !scEduRnd.equals("")'>
       			AND A.edu_rnd = #{scEduRnd}
        </if>
        
  		<choose>
            <when test='orderbyKey == 3'>ORDER BY A.crs_grd_cdv ASC</when>
            <when test='orderbyKey == -3'>ORDER BY A.crs_grd_cdv DESC</when>
            <when test='orderbyKey == 2'>ORDER BY A.edu_year ASC</when>
            <when test='orderbyKey == -2'>ORDER BY A.edu_year DESC</when>
            <when test='orderbyKey == 1'>ORDER BY A.frst_reg_dt ASC</when>
            <when test='orderbyKey == -1'>ORDER BY A.frst_reg_dt DESC</when>
            <otherwise>ORDER BY A.frst_reg_dt DESC</otherwise>
        </choose>

        <if test='currentPageNo != 0'>
        ) TB ) WHERE rn BETWEEN #{firstItemNo}+1  AND #{firstItemNo} + #{recordCountPerPage}
        </if>
    </select>

    <select id="selectListCount" parameterType="com.intermorph.wtst.wtst.service.IMWtstCondition" resultType="int">
/* IMWtstMapper.selectListCount */
SELECT COUNT(*) 
  FROM im_wtst A
 WHERE A.del_yn = 'N'  
 
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("wtstId")'>
       			AND A.wtst_id LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
        
         <if test='scCrsGrdCdv != null and !scCrsGrdCdv.equals("")'>
       			AND A.crs_grd_cdv = #{scCrsGrdCdv}
        </if>
        <if test='scSttsCdv != null and !scSttsCdv.equals("")'>
       			AND A.stts_cdv = #{scSttsCdv}
        </if>
        <if test='scEduYear != null and !scEduYear.equals("")'>
       			AND A.edu_year = #{scEduYear}
        </if>
        <if test='scEduRnd != null and !scEduRnd.equals("")'>
       			AND A.edu_rnd = #{scEduRnd}
        </if>
    </select>
</mapper>