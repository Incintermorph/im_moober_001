<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.intermorph.wtst.aplcnt.service.IMWtstAplcntMapper">

    <insert id="insert" parameterType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntVO" useGeneratedKeys="false">
/* IMWtstAplcntMapper.insert */
INSERT INTO im_wtst_aplcnt (
    wtst_aplcnt_id,
    wtst_place_id,
    mmbr_esntl_id,
    mber_id,
    sexdstn_cdv,
    mber_nm,
    mber_email_adres,
    mmbr_telno,
    brdt,
    pht_file_id,
    conv_evddoc_id,
    conv_pvsn_yn,
    exemp_dvsn_cdv,
    exemp_evddoc_id,
    wtn_ord,

	
	agncy_code,
	agncy_nm,
	work_dvsn_cdv,

    del_yn,
    frst_reger_id,
    frst_reg_dt,
    frst_reger_ip
) VALUES (
    #{wtstAplcntId, jdbcType=VARCHAR},
    #{wtstPlaceId, jdbcType=VARCHAR},
    #{mmbrEsntlId, jdbcType=VARCHAR},
    #{mberId, jdbcType=VARCHAR},
    #{sexdstnCdv, jdbcType=VARCHAR},
    #{mberNm, jdbcType=VARCHAR},
    #{mberEmailAdres, jdbcType=VARCHAR},
    #{mmbrTelnoDB, jdbcType=VARCHAR},
    #{brdt, jdbcType=VARCHAR},
    #{phtFileId, jdbcType=VARCHAR},
    #{convEvddocId, jdbcType=VARCHAR},
    #{convPvsnYn, jdbcType=VARCHAR},
    #{exempDvsnCdv, jdbcType=VARCHAR},
    #{exempEvddocId, jdbcType=VARCHAR},
    #{wtnOrd, jdbcType=NUMERIC},
    
	#{agncyCode, jdbcType=VARCHAR},
	#{agncyNm, jdbcType=VARCHAR},
	#{workDvsnCdv, jdbcType=VARCHAR},
	
     'N',
    #{frstRegerId, jdbcType=VARCHAR},
    TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
    #{frstRegerIp, jdbcType=VARCHAR}
) 
    </insert>

    <update id="update" parameterType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntVO">
/* IMWtstAplcntMapper.update */
UPDATE im_wtst_aplcnt
   SET 
   	   <if test='mmbrTelnoDB != null and !mmbrTelnoDB.equals("")'>
       mmbr_telno = #{mmbrTelnoDB, jdbcType=VARCHAR},
       </if>
   	   <if test='mberEmailAdres != null and !mberEmailAdres.equals("")'>
       mber_email_adres = #{mberEmailAdres, jdbcType=VARCHAR},
       </if>
   	   <if test='phtFileId != null and !phtFileId.equals("")'>
       pht_file_id = #{phtFileId, jdbcType=VARCHAR},
       </if>
       <if test='convEvddocId != null and !convEvddocId.equals("")'>
       conv_evddoc_id = #{convEvddocId, jdbcType=VARCHAR},
       </if>
       <if test='convPvsnYn != null and !convPvsnYn.equals("")'>
       conv_pvsn_yn = #{convPvsnYn, jdbcType=VARCHAR},
       </if>
       <if test='exempDvsnCdv != null and !exempDvsnCdv.equals("")'>
       exemp_dvsn_cdv = #{exempDvsnCdv, jdbcType=VARCHAR},
       </if>
       <if test='exempEvddocId != null and !exempEvddocId.equals("")'>
       exemp_evddoc_id = #{exempEvddocId, jdbcType=VARCHAR},
       </if>
       <if test='tktstno != null and !tktstno.equals("")'>
       tktstno = #{tktstno, jdbcType=VARCHAR},
       </if>
       <if test='workDvsnCdv != null and !workDvsnCdv.equals("")'>
       agncy_code = #{agncyCode, jdbcType=VARCHAR},
       agncy_nm = #{agncyNm, jdbcType=VARCHAR},
       work_dvsn_cdv = #{workDvsnCdv, jdbcType=VARCHAR},
       </if>
       <if test='sbjRslt != null and !sbjRslt.equals("")'>
       sbj_rslt = #{sbjRslt, jdbcType=VARCHAR},
       avg_scr = #{avgScr, jdbcType=VARCHAR},
       fltp_sbj_cnt = #{fltpSbjCnt, jdbcType=VARCHAR},
       pass_ymd =   #{passYmd, jdbcType=VARCHAR},
       vld_end_ymd =   #{vldEndYmd, jdbcType=VARCHAR},
       </if>
	   last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR}
 WHERE
       wtst_aplcnt_id = #{wtstAplcntId}

   AND del_yn = 'N' 
    </update>

    
    <update id="delete" parameterType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntVO">
/* IMWtstAplcntMapper.delete */
UPDATE im_wtst_aplcnt 
   SET last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR},
       del_yn = 'Y' 
 WHERE 
       wtst_aplcnt_id = #{wtstAplcntId}

   AND del_yn = 'N'
    </update>

    <resultMap id="selectDetailResultMap" type="com.intermorph.wtst.aplcnt.service.IMWtstAplcntResultSet">
        <result column="A.wtstAplcntId" property="wtstAplcnt.wtstAplcntId"/>
        <result column="A.wtstPlaceId" property="wtstAplcnt.wtstPlaceId"/>
        <result column="A.mmbrEsntlId" property="wtstAplcnt.mmbrEsntlId"/>
        <result column="A.mberId" property="wtstAplcnt.mberId"/>
        <result column="A.sexdstnCdv" property="wtstAplcnt.sexdstnCdv"/>
        <result column="A.mberNm" property="wtstAplcnt.mberNm"/>
        <result column="A.mberEmailAdres" property="wtstAplcnt.mberEmailAdres"/>
        <result column="A.mmbrTelno" property="wtstAplcnt.mmbrTelno"/>
        <result column="A.brdt" property="wtstAplcnt.brdt"/>
        <result column="phtFileId" property="wtstAplcnt.phtFileId"/>
        <result column="convEvddocId" property="wtstAplcnt.convEvddocId"/>
        <result column="A.convPvsnYn" property="wtstAplcnt.convPvsnYn"/>
        <result column="A.exempDvsnCdv" property="wtstAplcnt.exempDvsnCdv"/>
        <result column="exempEvddocId" property="wtstAplcnt.exempEvddocId"/>
        <result column="A.tktstno" property="wtstAplcnt.tktstno"/>
        <result column="A.wtnOrd" property="wtstAplcnt.wtnOrd"/>
        
        <result column="A.agncyNm" property="wtstAplcnt.agncyNm"/>
        <result column="A.agncyCode" property="wtstAplcnt.agncyCode"/>
        <result column="A.workDvsnCdv" property="wtstAplcnt.workDvsnCdv"/>
        
        <result column="A.sbjRslt" property="wtstAplcnt.sbjRslt"/>
        <result column="A.avgScr" property="wtstAplcnt.avgScr"/>
        <result column="A.fltpSbjCnt" property="wtstAplcnt.fltpSbjCnt"/>
        <result column="A.passYmd" property="wtstAplcnt.passYmd"/>
        <result column="A.vldEndYmd" property="wtstAplcnt.vldEndYmd"/>
       
        <result column="A.delYn" property="wtstAplcnt.delYn"/>
        <result column="A.frstRegerId" property="wtstAplcnt.frstRegerId"/>
        <result column="A.frstRegDt" property="wtstAplcnt.frstRegDt"/>
        <result column="A.frstRegerIp" property="wtstAplcnt.frstRegerIp"/>
        <result column="A.lastMdferId" property="wtstAplcnt.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="wtstAplcnt.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="wtstAplcnt.lastMdferIp"/>
        
        
        <result column="C.wtstPlaceId" property="wtstPlace.wtstPlaceId"/>
        <result column="C.wtstId" property="wtstPlace.wtstId"/>
        <result column="C.agncyId" property="wtstPlace.agncyId"/>
        <result column="C.cntpnt" property="wtstPlace.cntpnt"/>
        <result column="C.bnkCdv" property="wtstPlace.bnkCdv"/>
        <result column="C.accno" property="wtstPlace.accno"/>
        <result column="C.acchdr" property="wtstPlace.acchdr"/>
        <result column="C.prsnl" property="wtstPlace.prsnl"/>
        <result column="C.prsnlLmt" property="wtstPlace.prsnlLmt"/>
        <result column="C.prgrsSttsCdv" property="wtstPlace.prgrsSttsCdv"/>
        
        <result column="D.wtstId" property="wtst.wtstId"/>
        <result column="D.crsGrdCdv" property="wtst.crsGrdCdv"/>
        <result column="D.eduYear" property="wtst.eduYear"/>
        <result column="D.eduRnd" property="wtst.eduRnd"/>
        <result column="D.tstYmd" property="wtst.tstYmd"/>
        <result column="D.tstBgngHrs" property="wtst.tstBgngHrs"/>
        <result column="D.tstEndHrs" property="wtst.tstEndHrs"/>
        <result column="D.addtnYn" property="wtst.addtnYn"/>
        <result column="D.tstfee" property="wtst.tstfee"/>
        <result column="D.sttsCdv" property="wtst.sttsCdv"/>
        
        <collection column="{atchFileId=phtFileId}" property="fileList1" javaType="List" 
            ofType="egovframework.com.cmm.service.FileVO" select="com.intermorph.cmmn.egov.service.IMEgovMapper.selectFileList"/>
        <collection column="{atchFileId=convEvddocId}" property="fileList2" javaType="List" 
            ofType="egovframework.com.cmm.service.FileVO" select="com.intermorph.cmmn.egov.service.IMEgovMapper.selectFileList"/>
        <collection column="{atchFileId=exempEvddocId}" property="fileList3" javaType="List" 
            ofType="egovframework.com.cmm.service.FileVO" select="com.intermorph.cmmn.egov.service.IMEgovMapper.selectFileList"/>

    </resultMap>
    <select id="selectDetail" parameterType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntVO" resultMap="selectDetailResultMap">
        /* IMWtstAplcntMapper.selectDetail */
SELECT 
       A.wtst_aplcnt_id AS "A.wtstAplcntId",
       A.wtst_place_id AS "A.wtstPlaceId",
       A.mmbr_esntl_id AS "A.mmbrEsntlId",
       A.mber_id AS "A.mberId",
       A.sexdstn_cdv AS "A.sexdstnCdv",
       A.mber_nm AS "A.mberNm",
       A.mber_email_adres AS "A.mberEmailAdres",
       A.mmbr_telno AS "A.mmbrTelno",
       A.brdt AS "A.brdt",
       A.pht_file_id AS "phtFileId",
       A.conv_evddoc_id AS "convEvddocId",
       A.conv_pvsn_yn AS "A.convPvsnYn",
       A.exemp_dvsn_cdv AS "A.exempDvsnCdv",
       A.exemp_evddoc_id AS "exempEvddocId",
       
       A.agncy_code AS "A.agncyCode",
	   A.agncy_nm AS "A.agncyNm",
	   A.work_dvsn_cdv  AS "A.workDvsnCdv",
	    
       A.tktstno AS "A.tktstno",
       A.wtn_ord AS "A.wtnOrd",
       
       
       A.sbj_rslt AS "A.sbjRslt",
       A.avg_scr AS "A.avgScr",       
       A.fltp_sbj_cnt   AS "A.fltpSbjCnt",
       A.pass_ymd   AS "A.passYmd",
       A.vld_end_ymd AS  "A.vldEndYmd",
       
       
       A.del_yn AS "A.delYn",
       
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp",
       
       C.wtst_place_id AS "C.wtstPlaceId",
       C.wtst_id AS "C.wtstId",
       C.agncy_id AS "C.agncyId",
       C.cntpnt AS "C.cntpnt",
       C.bnk_cdv AS "C.bnkCdv",
       C.accno AS "C.accno",
       C.acchdr AS "C.acchdr",
       C.prsnl AS "C.prsnl",
       C.prsnl_lmt AS "C.prsnlLmt",
       C.prgrs_stts_cdv AS "C.prgrsSttsCdv",
       D.wtst_id AS "D.wtstId",
       D.crs_grd_cdv AS "D.crsGrdCdv",
       D.edu_year AS "D.eduYear",
       D.edu_rnd AS "D.eduRnd",
       D.tst_ymd AS "D.tstYmd",
       D.tst_bgng_hrs AS "D.tstBgngHrs",
       D.tst_end_hrs AS "D.tstEndHrs",
       D.addtn_yn AS "D.addtnYn",
       D.tstfee AS "D.tstfee",
       D.stts_cdv AS "D.sttsCdv"
       
  
  FROM im_wtst_aplcnt A
  INNER JOIN IM_wtst_place C ON A.wtst_place_id=C.wtst_place_id       
  INNER JOIN IM_wtst D ON C.wtst_id=D.wtst_id
 WHERE
       wtst_aplcnt_id = #{wtstAplcntId}

   AND A.del_yn = 'N'
    </select>


    <resultMap id="selectListResultMap" type="com.intermorph.wtst.aplcnt.service.IMWtstAplcntResultSet">
        <result column="A.wtstAplcntId" property="wtstAplcnt.wtstAplcntId"/>
        <result column="A.wtstPlaceId" property="wtstAplcnt.wtstPlaceId"/>
        <result column="A.mmbrEsntlId" property="wtstAplcnt.mmbrEsntlId"/>
        <result column="A.mberId" property="wtstAplcnt.mberId"/>
        <result column="A.sexdstnCdv" property="wtstAplcnt.sexdstnCdv"/>
        <result column="A.mberNm" property="wtstAplcnt.mberNm"/>
        <result column="A.mberEmailAdres" property="wtstAplcnt.mberEmailAdres"/>
        <result column="A.mmbrTelno" property="wtstAplcnt.mmbrTelno"/>
        <result column="A.brdt" property="wtstAplcnt.brdt"/>
        <result column="A.phtFileId" property="wtstAplcnt.phtFileId"/>
        <result column="A.convEvddocId" property="wtstAplcnt.convEvddocId"/>
        <result column="A.convPvsnYn" property="wtstAplcnt.convPvsnYn"/>
        <result column="A.exempDvsnCdv" property="wtstAplcnt.exempDvsnCdv"/>
        <result column="A.exempEvddocId" property="wtstAplcnt.exempEvddocId"/>
        <result column="A.tktstno" property="wtstAplcnt.tktstno"/>
        <result column="A.wtnOrd" property="wtstAplcnt.wtnOrd"/>
        
        <result column="A.sbjRslt" property="wtstAplcnt.sbjRslt"/>
        <result column="A.avgScr" property="wtstAplcnt.avgScr"/>
        <result column="A.fltpSbjCnt" property="wtstAplcnt.fltpSbjCnt"/>
        <result column="A.passYmd" property="wtstAplcnt.passYmd"/>
        <result column="A.vldEndYmd" property="wtstAplcnt.vldEndYmd"/>
        
        
        <result column="A.delYn" property="wtstAplcnt.delYn"/>
        <result column="A.frstRegerId" property="wtstAplcnt.frstRegerId"/>
        <result column="A.frstRegDt" property="wtstAplcnt.frstRegDt"/>
        <result column="A.frstRegerIp" property="wtstAplcnt.frstRegerIp"/>
        <result column="A.lastMdferId" property="wtstAplcnt.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="wtstAplcnt.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="wtstAplcnt.lastMdferIp"/>
        
        <result column="A.agncyNm" property="wtstAplcnt.agncyNm"/>
        <result column="A.agncyCode" property="wtstAplcnt.agncyCode"/>
        <result column="A.workDvsnCdv" property="wtstAplcnt.workDvsnCdv"/>
        <result column="sttDdvs" property="sttDdvs"/>
        <result column="sttDdvIds" property="sttDdvIds"/>
        <result column="sttDdvDts" property="sttDdvDts"/>
        <result column="wtstDts" property="wtstDts"/>
        
        <result column="C.wtstPlaceId" property="wtstPlace.wtstPlaceId"/>
        <result column="C.wtstId" property="wtstPlace.wtstId"/>
        <result column="C.agncyId" property="wtstPlace.agncyId"/>
        <result column="C.cntpnt" property="wtstPlace.cntpnt"/>
        <result column="C.bnkCdv" property="wtstPlace.bnkCdv"/>
        <result column="C.accno" property="wtstPlace.accno"/>
        <result column="C.acchdr" property="wtstPlace.acchdr"/>
        <result column="C.prsnl" property="wtstPlace.prsnl"/>
        <result column="C.prsnlLmt" property="wtstPlace.prsnlLmt"/>
        <result column="C.prgrsSttsCdv" property="wtstPlace.prgrsSttsCdv"/>
        
        <result column="D.wtstId" property="wtst.wtstId"/>
        <result column="D.crsGrdCdv" property="wtst.crsGrdCdv"/>
        <result column="D.eduYear" property="wtst.eduYear"/>
        <result column="D.eduRnd" property="wtst.eduRnd"/>
        <result column="D.tstYmd" property="wtst.tstYmd"/>
        <result column="D.tstBgngHrs" property="wtst.tstBgngHrs"/>
        <result column="D.tstEndHrs" property="wtst.tstEndHrs"/>
        <result column="D.addtnYn" property="wtst.addtnYn"/>
        <result column="D.tstfee" property="wtst.tstfee"/>
        <result column="D.sttsCdv" property="wtst.sttsCdv"/>
        <result column="E.agncyNm" property="agncy.agncyNm"/>
        <result column="fnshYn" property="fnshYn"/>

    </resultMap>
    <select id="selectList" parameterType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntCondition" resultMap="selectListResultMap">
/* IMWtstAplcntMapper.selectList */
         <if test='currentPageNo != 0'>
SELECT * FROM ( SELECT rownum rn, TB.* FROM (
        </if>
SELECT
       A.wtst_aplcnt_id AS "A.wtstAplcntId",
       A.wtst_place_id AS "A.wtstPlaceId",
       A.mmbr_esntl_id AS "A.mmbrEsntlId",
       A.mber_id AS "A.mberId",
       A.sexdstn_cdv AS "A.sexdstnCdv",
       A.mber_nm AS "A.mberNm",
       A.mber_email_adres AS "A.mberEmailAdres",
       A.mmbr_telno AS "A.mmbrTelno",
       A.pht_file_id AS "A.phtFileId",
       A.brdt AS "A.brdt",
       A.conv_evddoc_id AS "A.convEvddocId",
       A.conv_pvsn_yn AS "A.convPvsnYn",
       A.exemp_dvsn_cdv AS "A.exempDvsnCdv",
       A.exemp_evddoc_id AS "A.exempEvddocId",
       A.tktstno AS "A.tktstno",
       A.wtn_ord AS "A.wtnOrd",
       
       A.agncy_code AS "A.agncyCode",
	   A.agncy_nm AS "A.agncyNm",
	   A.work_dvsn_cdv  AS "A.workDvsnCdv",
	   
	   
       A.sbj_rslt AS "A.sbjRslt",
       A.avg_scr AS "A.avgScr",       
       A.fltp_sbj_cnt   AS "A.fltpSbjCnt",
       A.pass_ymd   AS "A.passYmd",
       A.vld_end_ymd AS  "A.vldEndYmd",
       
       
       
       
	   
       A.del_yn AS "A.delYn",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp",
       CONCAT('APLY=',B.APLY,',FNSH=',B.FNSH,',OPSECT_SRNG=',B.OPSECT_SRNG,',DPST=',B.DPST) AS "sttDdvs",
       CONCAT('APLY=',B.APLY_ID,',FNSH=',B.FNSH_ID,',OPSECT_SRNG=',B.OPSECT_SRNG_ID,',DPST=',B.DPST_ID) AS "sttDdvIds",
       CONCAT('APLY=',B.APLY_DT,',FNSH=',B.FNSH_DT,',OPSECT_SRNG=',B.OPSECT_SRNG_DT,',DPST=',B.DPST_DT) AS "sttDdvDts" ,
       CONCAT('rcptTerm_bgnDt=',F.rcptTerm_bgnDt
       ,',rcptTerm_endDt=',F.rcptTerm_endDt
       ,',passTerm_bgnDt=',F.passTerm_bgnDt
       ,',passTerm_endDt=',F.passTerm_endDt
       ,',slctnTerm_bgnDt=',F.slctnTerm_bgnDt
       ,',slctnTerm_endDt=',F.slctnTerm_endDt
       ,',pbancTerm_bgnDt=',F.pbancTerm_bgnDt
       ,',pbancTerm_endDt=',F.pbancTerm_endDt
       ,',payTerm_bgnDt=',F.payTerm_bgnDt
       ,',payTerm_endDt=',F.payTerm_endDt
       ) AS "wtstDts",
       C.wtst_place_id AS "C.wtstPlaceId",
       C.wtst_id AS "C.wtstId",
       C.agncy_id AS "C.agncyId",
       C.cntpnt AS "C.cntpnt",
       C.bnk_cdv AS "C.bnkCdv",
       C.accno AS "C.accno",
       C.acchdr AS "C.acchdr",
       C.prsnl AS "C.prsnl",
       C.prsnl_lmt AS "C.prsnlLmt",
       C.prgrs_stts_cdv AS "C.prgrsSttsCdv",
       D.wtst_id AS "D.wtstId",
       D.crs_grd_cdv AS "D.crsGrdCdv",
       D.edu_year AS "D.eduYear",
       D.edu_rnd AS "D.eduRnd",
       D.tst_ymd AS "D.tstYmd",
       D.tst_bgng_hrs AS "D.tstBgngHrs",
       D.tst_end_hrs AS "D.tstEndHrs",
       D.addtn_yn AS "D.addtnYn",
       D.tstfee AS "D.tstfee",
       D.stts_cdv AS "D.sttsCdv",
       
 		<if test='scFnshYnCheck != null and !scFnshYnCheck.equals("")'>
       NVL(stat.fnshYn,'N') AS "fnshYn",
       </if>
       E.agncy_nm AS "E.agncyNm"
       

  FROM im_wtst_aplcnt A
  INNER JOIN 
       (
			<include refid="view_wtstaplcnt_cmmn_stts_inc"></include>
       )B
       ON     A.wtst_aplcnt_id=B.tbl_ref_id
  INNER JOIN IM_wtst_place C ON A.wtst_place_id=C.wtst_place_id       
  INNER JOIN IM_wtst D ON C.wtst_id=D.wtst_id
  INNER JOIN IM_AGNCY E ON C.agncy_id=E.agncy_id
   INNER JOIN 
       (
			<include refid="view_wtstaplcnt_cmmn_dt_inc"></include>
       )F
       ON     D.wtst_id=F.tbl_ref_id
       <if test='scFnshYnCheck != null and !scFnshYnCheck.equals("")'>
   LEFT OUTER JOIN 
   (
   		SELECT ic.crs_grd_cdv , ia.mmbr_esntl_id,'Y' AS fnshYn
         FROM    im_crs_aplcnt_rslt ia
                 INNER JOIN im_crs ib
                 ON      ia.crs_id=ib.crs_id
                 INNER JOIN im_crs_mstr ic
                 ON      ib.crs_mstr_id = ic.crs_mstr_id
         WHERE   ia.fnsh_stts_cdv       ='02'
         AND     ic.crs_dvsn_cdv        ='CRS_DVSN_001'
         GROUP BY  ic.crs_dvsn_cdv , ia.mmbr_esntl_id
   
   )stat ON     stat.mmbr_esntl_id=A.mmbr_esntl_id  AND stat.crs_grd_cdv=D.crs_grd_cdv
   		</if> 
 WHERE A.del_yn = 'N'
 		
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("wtstAplcntId")'>
       			AND A.wtst_aplcnt_id LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("agncyNm")'>
       			AND E.agncy_nm LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("mberNm")'>
       			AND  A.mber_nm  LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("mberId")'>
       			AND  A.mber_id  LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("mblTelno")'>
       			AND  A.mmbr_telno  LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("eml")'>
       			AND  A.mber_email_adres  LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
        
 		<if test='scFnshYnCheck != null and !scFnshYnCheck.equals("")'>
 			<if test='scFnshYn != null and !scFnshYn.equals("")'>
 			<if test='scFnshYn.equals("Y")'>
 				AND stat.fnshYn IS NOT NULL
 			</if>
 			<if test='!scFnshYn.equals("Y")'>
 				AND stat.fnshYn IS  NULL
 			</if>
 			</if>
 		</if>
 		<if test='scMmbrEsntlId != null and !scMmbrEsntlId.equals("")'>
       			AND A.mmbr_esntl_id = #{scMmbrEsntlId} 
        </if>  
        <if test='scNotAplyCancleYn != null and !scNotAplyCancleYn.equals("")'>
 			 <if test='scNotAplyCancleYn.equals("Y")'>
       			AND B.APLY!='03'
            </if>
        </if>
        
        <if test='scWtstId != null and !scWtstId.equals("")'>
       			AND C.wtst_id = #{scWtstId}
        </if>
        
        <if test='scPrgrsStts != null and !scPrgrsStts.equals("")'>
       			AND C.prgrs_stts_cdv = #{scPrgrsStts}
        </if>
        
        <if test='scWtstPlaceId != null and !scWtstPlaceId.equals("")'>
       			AND A.wtst_place_id = #{scWtstPlaceId}
        </if>
        
        <if test='scExempDvsnCdv != null and !scExempDvsnCdv.equals("")'>
       			AND A.exemp_dvsn_cdv = #{scExempDvsnCdv}
        </if>
        
        <if test='scConvPvsnYn != null and !scConvPvsnYn.equals("")'>
       			AND A.conv_pvsn_yn = #{scConvPvsnYn}
        </if>
        
        <if test='scAgncyId != null and !scAgncyId.equals("")'>
       			AND C.agncy_id = #{scAgncyId}
        </if>
 		<if test='scAplyStts != null and !scAplyStts.equals("")'>
 			<choose>
	            <when test='scAplyStts.equals("01A")'>
	            		AND B.APLY IN ('01','0101')
	            </when>
	            <when test='scAplyStts.equals("02A")'>
	            		 <![CDATA[
	            		AND B.APLY = '02'
	            		AND F.passTerm_bgnDt < TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss')
       					]]>
	            </when>
	            <when test='scAplyStts.equals("0204")'>
	            		AND B.APLY IN ('02','04')
	            </when>
	            <otherwise>
	            	AND B.APLY = #{scAplyStts}
	            </otherwise>
        	</choose>
        </if> 
        
        <if test='scDpstStts != null and !scDpstStts.equals("")'>
       			AND B.DPST = #{scDpstStts}
        </if>
        
        <if test='scCrsGrdCdv != null and !scCrsGrdCdv.equals("")'>
       			AND D.crs_grd_cdv = #{scCrsGrdCdv}
        </if>
        <if test='scEduYear != null and !scEduYear.equals("")'>
       			AND D.edu_year = #{scEduYear}
        </if>
        <if test='scEduRnd != null and !scEduRnd.equals("")'>
       			AND D.edu_rnd = #{scEduRnd}
        </if>
        <if test='scExamFnshYn != null and !scExamFnshYn.equals("")'>
       			AND B.FNSH = #{scExamFnshYn}
        </if>
        
  		<choose>
            <when test='orderbyKey == 5'>ORDER BY B.DPST_DT</when>
            <when test='orderbyKey == -5'>ORDER BY B.DPST_DT DESC</when>
            <when test='orderbyKey == 4'>ORDER BY A.wtn_ord ASC ,D.crs_grd_cdv,D.edu_year,D.edu_rnd,A.frst_reg_dt</when>
            <when test='orderbyKey == -4'>ORDER BY A.wtn_ord DESC,D.crs_grd_cdv,D.edu_year,D.edu_rnd,A.frst_reg_dt</when>
            <when test='orderbyKey == 3'>ORDER BY A.mber_nm ASC</when>
            <when test='orderbyKey == -3'>ORDER BY A.mber_nm DESC</when>
            <when test='orderbyKey == 2'>ORDER BY A.mber_id ASC</when>
            <when test='orderbyKey == -2'>ORDER BY A.mber_id DESC</when>
            <when test='orderbyKey == 1'>ORDER BY A.frst_reg_dt ASC</when>
            <when test='orderbyKey == -1'>ORDER BY A.frst_reg_dt DESC</when>
            <otherwise>ORDER BY A.frst_reg_dt DESC</otherwise>
        </choose>

        <if test='currentPageNo != 0'>
        ) TB ) WHERE rn BETWEEN #{firstItemNo}+1  AND #{firstItemNo} + #{recordCountPerPage}
        </if>
    </select>

    <select id="selectListCount" parameterType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntCondition" resultType="int">
/* IMWtstAplcntMapper.selectListCount */
SELECT COUNT(*) 
  FROM im_wtst_aplcnt A
  INNER JOIN 
       (
			<include refid="view_wtstaplcnt_cmmn_stts_inc"></include>
       )B
       ON     A.wtst_aplcnt_id=B.tbl_ref_id
  INNER JOIN IM_wtst_place C ON A.wtst_place_id=C.wtst_place_id
  INNER JOIN IM_wtst D ON C.wtst_id=D.wtst_id
  INNER JOIN IM_AGNCY E ON C.agncy_id=E.agncy_id
   INNER JOIN 
       (
			<include refid="view_wtstaplcnt_cmmn_dt_inc"></include>
       )F
       ON     D.wtst_id=F.tbl_ref_id
   
       <if test='scFnshYnCheck != null and !scFnshYnCheck.equals("")'>
   LEFT OUTER JOIN 
   (
   		SELECT ic.crs_grd_cdv , ia.mmbr_esntl_id,'Y' AS fnshYn
         FROM    im_crs_aplcnt_rslt ia
                 INNER JOIN im_crs ib
                 ON      ia.crs_id=ib.crs_id
                 INNER JOIN im_crs_mstr ic
                 ON      ib.crs_mstr_id = ic.crs_mstr_id
         WHERE   ia.fnsh_stts_cdv       ='02'
         AND     ic.crs_dvsn_cdv        ='CRS_DVSN_001'
         GROUP BY  ic.crs_dvsn_cdv , ia.mmbr_esntl_id
   
   )stat ON     stat.mmbr_esntl_id=A.mmbr_esntl_id  AND stat.crs_grd_cdv=D.crs_grd_cdv
   		</if>     
 WHERE A.del_yn = 'N'
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("wtstAplcntId")'>
       			AND A.wtst_aplcnt_id LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("agncyNm")'>
       			AND E.agncy_nm LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("mberNm")'>
       			AND  A.mber_nm  LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("mberId")'>
       			AND  A.mber_id  LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("mblTelno")'>
       			AND  A.mmbr_telno  LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("eml")'>
       			AND  A.mber_email_adres  LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
        <if test='scFnshYnCheck != null and !scFnshYnCheck.equals("")'>
 			<if test='scFnshYn != null and !scFnshYn.equals("")'>
 			<if test='scFnshYn.equals("Y")'>
 				AND stat.fnshYn IS NOT NULL
 			</if>
 			<if test='!scFnshYn.equals("Y")'>
 				AND stat.fnshYn IS  NULL
 			</if>
 			</if>
 		</if>
 		<if test='scMmbrEsntlId != null and !scMmbrEsntlId.equals("")'>
       			AND A.mmbr_esntl_id = #{scMmbrEsntlId} 
        </if>  
        <if test='scNotAplyCancleYn != null and !scNotAplyCancleYn.equals("")'>
 			 <if test='scNotAplyCancleYn.equals("Y")'>
       			AND B.APLY!='03'
            </if>
        </if>
        
        <if test='scWtstId != null and !scWtstId.equals("")'>
       			AND C.wtst_id = #{scWtstId}
        </if>
        <if test='scPrgrsStts != null and !scPrgrsStts.equals("")'>
       			AND C.prgrs_stts_cdv = #{scPrgrsStts}
        </if>
        
        <if test='scWtstPlaceId != null and !scWtstPlaceId.equals("")'>
       			AND A.wtst_place_id = #{scWtstPlaceId}
        </if>
        
        <if test='scExempDvsnCdv != null and !scExempDvsnCdv.equals("")'>
       			AND A.exemp_dvsn_cdv = #{scExempDvsnCdv}
        </if>
        
        <if test='scConvPvsnYn != null and !scConvPvsnYn.equals("")'>
       			AND A.conv_pvsn_yn = #{scConvPvsnYn}
        </if>
        
        <if test='scAgncyId != null and !scAgncyId.equals("")'>
       			AND C.agncy_id = #{scAgncyId}
        </if>
 		<if test='scAplyStts != null and !scAplyStts.equals("")'>
 			<choose>
	            <when test='scAplyStts.equals("01A")'>
	            		AND B.APLY IN ('01','0101')
	            </when>
	            <when test='scAplyStts.equals("02A")'>
	            		 <![CDATA[
	            		AND B.APLY = '02'
	            		AND F.passTerm_bgnDt < TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss')
       					]]>
	            </when>
	            <when test='scAplyStts.equals("0204")'>
	            		AND B.APLY IN ('02','04')
	            </when>
	            <otherwise>
	            	AND B.APLY = #{scAplyStts}
	            </otherwise>
        	</choose>
        </if> 
        
        <if test='scDpstStts != null and !scDpstStts.equals("")'>
       			AND B.DPST = #{scDpstStts}
        </if>
        
        <if test='scCrsGrdCdv != null and !scCrsGrdCdv.equals("")'>
       			AND D.crs_grd_cdv = #{scCrsGrdCdv}
        </if>
        <if test='scEduYear != null and !scEduYear.equals("")'>
       			AND D.edu_year = #{scEduYear}
        </if>
        <if test='scEduRnd != null and !scEduRnd.equals("")'>
       			AND D.edu_rnd = #{scEduRnd}
        </if>
        <if test='scExamFnshYn != null and !scExamFnshYn.equals("")'>
       			AND B.FNSH = #{scExamFnshYn}
        </if>
         
    </select>
    
     <select id="selectOverAplyCount" parameterType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntVO" resultType="int">
	/* IMWtstAplcntMapper.selectOverAplyCount */
	SELECT COUNT(*) FROM im_wtst_aplcnt a
INNER JOIN im_wtst_place b ON a.wtst_place_id=b.wtst_place_id
INNER JOIN im_wtst c ON b.wtst_id=c.wtst_id
INNER JOIN im_cmmn_stts d
	       ON     a.wtst_aplcnt_id=tbl_ref_id
	       AND    d.tbl_id         ='IM_WTST_APLCNT'
	AND    d.ref_nm                ='APLY'
	AND    d.stts_cdv             !='03'  	
	AND    a.del_yn='N'
	AND    b.del_yn='N'
WHERE a.mmbr_esntl_id=#{mmbrEsntlId}
	AND  b.wtst_id=#{wtstId}
	
    </select>
     <select id="selectAplyCount" parameterType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntVO" resultType="int">
	/* IMWtstAplcntMapper.selectAplyCount */
	SELECT COUNT(*) FROM im_wtst_aplcnt a
INNER JOIN im_wtst_place b ON a.wtst_place_id=b.wtst_place_id
INNER JOIN im_wtst c ON b.wtst_id=c.wtst_id
INNER JOIN im_cmmn_stts d
	       ON     a.wtst_aplcnt_id=tbl_ref_id
	       AND    d.tbl_id         ='IM_WTST_APLCNT'
	AND    d.ref_nm                ='APLY'
	AND    d.stts_cdv             !='03' 	
	AND    a.del_yn='N'
	AND    b.del_yn='N'
WHERE   b.wtst_place_id=#{wtstPlaceId}
	
    </select>
    
    <select id="selectAplyMAXWaitOrder" parameterType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntVO" resultType="Long">
	/* IMWtstAplcntMapper.selectAplyMAXWaitOrder */
	SELECT NVL(MAX(a.wtn_ord),0) wtnOrd FROM im_wtst_aplcnt a
	WHERE   a.wtst_place_id=#{wtstPlaceId}
    </select>
    
    <select id="selectAplyOPSECTSRNG" parameterType="map" resultType="com.intermorph.cmmn.service.IMCmmnSttsVO">
	/* IMCrsAplcntMapper.selectAplyOPSECTSRNG */
	SELECT 
		B.tbl_ref_id AS tblRefId
		,B.tbl_id  AS tblId
		,OPSECT_SRNG AS sttsCdv
		,CASE WHEN wtn_ord=0 then '01' ELSE '0101' END AS chageStts
		FROM 
		im_wtst_aplcnt A
		INNER JOIN  
		(
		<include refid="view_wtstaplcnt_cmmn_stts_inc"></include>
		
		) B
       ON     A.wtst_aplcnt_id=B.tbl_ref_id
		WHERE 
			A.del_yn='N' 
			AND A.wtst_place_id=#{wtstPlaceId}  
			AND EXISTS
			(
			SELECT 1 FROM im_cmmn_stts Z  WHERE tbl_id='IM_WTST_APLCNT' AND ref_nm='APLY' AND A.wtst_aplcnt_id=Z.tbl_ref_id
			AND stts_cdv!='03'
			)  
    </select>

	
	
	<select id="selectAplyStat" parameterType="map" resultType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntVO">
	/* IMWtstAplcntMapper.selectAplyStat */

SELECT COUNT(*) cnt , 'wtstAplyCnt' statType FROM im_wtst_aplcnt A 
INNER JOIN im_cmmn_stts st ON  st.tbl_id='IM_WTST_APLCNT' AND ref_nm='APLY' AND stts_cdv!='03' AND A.wtst_aplcnt_id=st.tbl_ref_id
WHERE A.mmbr_esntl_id=#{mmbrEsntlId}AND A.del_yn='N'

UNION ALL

SELECT COUNT(*) cnt , 'wtstFnsh02Cnt' statType   FROM im_wtst_aplcnt  A 
INNER JOIN im_cmmn_stts st ON  st.tbl_id='IM_WTST_APLCNT' AND ref_nm='FNSH' AND stts_cdv='02' AND A.wtst_aplcnt_id=st.tbl_ref_id
WHERE A.mmbr_esntl_id=#{mmbrEsntlId} AND A.del_yn='N'

	
    </select>
    
    
      <select id="selectOneWtstExcel" parameterType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntVO" resultType="com.intermorph.wtst.aplcnt.service.IMWtstAplcntVO">
	/* IMWtstAplcntMapper.selectOneWtstExcel */
		SELECT a.wtst_aplcnt_id AS "wtstAplcntId",
		       b.wtst_id AS "wtstId",
		       a.tktstno AS "tktstno",
		       a.mber_nm AS "mberNm",
		       a.brdt AS "brdt",
		       a.wtst_place_id AS "wtstPlaceId",
		       a.mmbr_esntl_id AS "mmbrEsntlId"
		FROM   im_wtst_aplcnt a
		       INNER JOIN im_wtst_place b
		       ON     a.wtst_place_id                 =b.wtst_place_id
		WHERE  tktstno                                =#{tktstno}
		AND    REPLACE(REPLACE(a.brdt,'-',''),'.','') = REPLACE(REPLACE(#{brdt},'-',''),'.','')
		AND    a.mber_nm                              =#{mberNm}
		AND    a.del_yn                               ='N' 
		LIMIT 1
	
    </select>

    
      <sql id="view_wtstaplcnt_cmmn_stts_inc">
    
    	 SELECT 
					 st.tbl_id,st.tbl_ref_id  ,
					 MAX(CASE WHEN st.ref_nm='APLY' THEN stts_cdv ELSE '' END) AS APLY,
					 MAX(CASE WHEN st.ref_nm='APLY' THEN last_mdfer_id ELSE '' END) AS APLY_ID,
					 MAX(CASE WHEN st.ref_nm='APLY' THEN last_mdfcn_dt ELSE '' END) AS APLY_DT,					 
					 MAX(CASE WHEN st.ref_nm='FNSH' THEN stts_cdv ELSE '' END) AS FNSH,
					 MAX(CASE WHEN st.ref_nm='FNSH' THEN last_mdfer_id ELSE '' END) AS FNSH_ID,
					 MAX(CASE WHEN st.ref_nm='FNSH' THEN last_mdfcn_dt ELSE '' END) AS FNSH_DT,
					 MAX(CASE WHEN st.ref_nm='DPST' THEN stts_cdv ELSE '' END) AS DPST,
					 MAX(CASE WHEN st.ref_nm='DPST' THEN last_mdfer_id ELSE '' END) AS DPST_ID,
					 MAX(CASE WHEN st.ref_nm='DPST' THEN last_mdfcn_dt ELSE '' END) AS DPST_DT,
					 MAX(CASE WHEN st.ref_nm='OPSECT_SRNG' THEN stts_cdv ELSE '' END) AS OPSECT_SRNG,
					 MAX(CASE WHEN st.ref_nm='OPSECT_SRNG' THEN last_mdfer_id ELSE '' END) AS OPSECT_SRNG_ID,
					 MAX(CASE WHEN st.ref_nm='OPSECT_SRNG' THEN last_mdfcn_dt ELSE '' END) AS OPSECT_SRNG_DT
				 FROM im_cmmn_stts st WHERE st.tbl_id='IM_WTST_APLCNT' GROUP BY st.tbl_id,st.tbl_ref_id
    
	
	</sql>
	<sql id="view_wtstaplcnt_cmmn_dt_inc">
    
			SELECT dt.tbl_id,dt.tbl_ref_id ,  
				 MAX(CASE WHEN dt.ref_nm='pbancTerm' THEN bgn_dt ELSE '' END) AS pbancTerm_bgnDt,
				 MAX(CASE WHEN dt.ref_nm='pbancTerm' THEN end_dt ELSE '' END) AS pbancTerm_endDt,
				 MAX(CASE WHEN dt.ref_nm='slctnTerm' THEN bgn_dt ELSE '' END) AS slctnTerm_bgnDt,
				 MAX(CASE WHEN dt.ref_nm='slctnTerm' THEN end_dt ELSE '' END) AS slctnTerm_endDt,
				 MAX(CASE WHEN dt.ref_nm='passTerm' THEN bgn_dt ELSE '' END) AS passTerm_bgnDt,
				 MAX(CASE WHEN dt.ref_nm='passTerm' THEN end_dt ELSE '' END) AS passTerm_endDt,
				 MAX(CASE WHEN dt.ref_nm='rcptTerm' THEN bgn_dt ELSE '' END) AS rcptTerm_bgnDt,
				 MAX(CASE WHEN dt.ref_nm='rcptTerm' THEN end_dt ELSE '' END) AS rcptTerm_endDt,
				 MAX(CASE WHEN dt.ref_nm='payTerm' THEN bgn_dt ELSE '' END) AS payTerm_bgnDt,
				 MAX(CASE WHEN dt.ref_nm='payTerm' THEN end_dt ELSE '' END) AS payTerm_endDt
				 FROM im_cmmn_dt dt WHERE dt.tbl_id='IM_WTST' GROUP BY dt.tbl_id,dt.tbl_ref_id
	</sql>
</mapper>