<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.intermorph.crs.agncy.service.IMAgncyMapper">

    <insert id="insert" parameterType="com.intermorph.crs.agncy.service.IMAgncyVO" useGeneratedKeys="false">
/* IMAgncyMapper.insert */
INSERT INTO im_agncy (
    agncy_id,
    agncy_nm,
    agncy_dvsn_cdv,
    brno,
    crs_grd_cdv,
    telno,
    fax,
    bnk_cdv,
    accno,
    acchdr,
    zipc,
    addr,
    addr_sido,
    addr_sigungu,
    addr_dtl,    
    area_cdv,
    area_dtl,
    agncy_url,
    logo_file_id,
    seal_file_id,
    dsgn_yn,
    link_code,
    fnsh_code,

    del_yn,
    frst_reger_id,
    frst_reg_dt,
    frst_reger_ip
) VALUES (
    #{agncyId, jdbcType=VARCHAR},
    #{agncyNm, jdbcType=VARCHAR},
    #{agncyDvsnCdv, jdbcType=VARCHAR},
    #{brno, jdbcType=VARCHAR},
    #{crsGrdCdv, jdbcType=VARCHAR},
    #{telnoDB, jdbcType=VARCHAR},
    #{fax, jdbcType=VARCHAR},
    #{bnkCdv, jdbcType=VARCHAR},
    #{accno, jdbcType=VARCHAR},
    #{acchdr, jdbcType=VARCHAR},
    #{zipc, jdbcType=VARCHAR},
    #{addr, jdbcType=VARCHAR},
    #{addrSido, jdbcType=VARCHAR},
    #{addrSigungu, jdbcType=VARCHAR},
    #{addrDtl, jdbcType=VARCHAR},
    #{areaCdv, jdbcType=VARCHAR},
    #{areaDtl, jdbcType=VARCHAR},
    #{agncyUrl, jdbcType=VARCHAR},
    #{logoFileId, jdbcType=VARCHAR},
    #{sealFileId, jdbcType=VARCHAR},
    #{dsgnYn, jdbcType=VARCHAR},
    #{linkCode, jdbcType=VARCHAR},
    #{fnshCode, jdbcType=VARCHAR},

     'N',
    #{frstRegerId, jdbcType=VARCHAR},
    TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
    #{frstRegerIp, jdbcType=VARCHAR}
) 
    </insert>

    <update id="update" parameterType="com.intermorph.crs.agncy.service.IMAgncyVO">
/* IMAgncyMapper.update */
UPDATE im_agncy
   SET 
       agncy_nm = #{agncyNm, jdbcType=VARCHAR},
       agncy_dvsn_cdv = #{agncyDvsnCdv, jdbcType=VARCHAR},
       brno = #{brno, jdbcType=VARCHAR},
       crs_grd_cdv = #{crsGrdCdv, jdbcType=VARCHAR},
       telno = #{telnoDB, jdbcType=VARCHAR},
       fax = #{fax, jdbcType=VARCHAR},
       bnk_cdv = #{bnkCdv, jdbcType=VARCHAR},
       accno = #{accno, jdbcType=VARCHAR},
       acchdr = #{acchdr, jdbcType=VARCHAR},
       zipc = #{zipc, jdbcType=VARCHAR},
       addr = #{addr, jdbcType=VARCHAR},
       addr_sido = #{addrSido, jdbcType=VARCHAR},
       addr_sigungu = #{addrSigungu, jdbcType=VARCHAR},
       addr_dtl = #{addrDtl, jdbcType=VARCHAR}, 
       area_cdv = #{areaCdv, jdbcType=VARCHAR},
       area_dtl = #{areaDtl, jdbcType=VARCHAR},      
       agncy_url = #{agncyUrl, jdbcType=VARCHAR},
       logo_file_id = #{logoFileId, jdbcType=VARCHAR},
       seal_file_id = #{sealFileId, jdbcType=VARCHAR},
       dsgn_yn = #{dsgnYn, jdbcType=VARCHAR},
       link_code = #{linkCode, jdbcType=VARCHAR},
       fnsh_code = #{fnshCode, jdbcType=VARCHAR},

	   last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR}
 WHERE
       agncy_id = #{agncyId}

   AND del_yn = 'N' 
    </update>

    <update id="delete" parameterType="com.intermorph.crs.agncy.service.IMAgncyVO">
/* IMAgncyMapper.delete */
UPDATE im_agncy 
   SET last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR},
       del_yn = 'Y' 
 WHERE 
       agncy_id = #{agncyId}

   AND del_yn = 'N'
    </update>

    <resultMap id="selectDetailResultMap" type="com.intermorph.crs.agncy.service.IMAgncyResultSet">
        <result column="A.agncyId" property="agncy.agncyId"/>
        <result column="A.agncyNm" property="agncy.agncyNm"/>
        <result column="A.agncyDvsnCdv" property="agncy.agncyDvsnCdv"/>
        <result column="A.brno" property="agncy.brno"/>
        <result column="A.crsGrdCdv" property="agncy.crsGrdCdv"/>
        <result column="A.telno" property="agncy.telno"/>
        <result column="A.fax" property="agncy.fax"/>
        <result column="A.bnkCdv" property="agncy.bnkCdv"/>
        <result column="A.accno" property="agncy.accno"/>
        <result column="A.acchdr" property="agncy.acchdr"/>
        <result column="A.zipc" property="agncy.zipc"/>
        <result column="A.addr" property="agncy.addr"/>
        <result column="A.addrSido" property="agncy.addrSido"/>
        <result column="A.addrSigungu" property="agncy.addrSigungu"/>
        <result column="A.addrDtl" property="agncy.addrDtl"/>
        <result column="A.areaCdv" property="agncy.areaCdv"/>
        <result column="A.areaDtl" property="agncy.areaDtl"/>
        <result column="A.agncyUrl" property="agncy.agncyUrl"/>
        <result column="A.logoFileId" property="agncy.logoFileId"/>
        <result column="A.sealFileId" property="agncy.sealFileId"/>
        <result column="A.dsgnYn" property="agncy.dsgnYn"/>
        <result column="A.linkCode" property="agncy.linkCode"/>
        <result column="A.fnshCode" property="agncy.fnshCode"/>
        <result column="A.delYn" property="agncy.delYn"/>
        <result column="A.frstRegerId" property="agncy.frstRegerId"/>
        <result column="A.frstRegDt" property="agncy.frstRegDt"/>
        <result column="A.frstRegerIp" property="agncy.frstRegerIp"/>
        <result column="A.lastMdferId" property="agncy.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="agncy.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="agncy.lastMdferIp"/>

    </resultMap>
    <select id="selectDetail" parameterType="com.intermorph.crs.agncy.service.IMAgncyVO" resultMap="selectDetailResultMap">
        /* IMAgncyMapper.selectDetail */
SELECT 
       A.agncy_id AS "A.agncyId",
       A.agncy_nm AS "A.agncyNm",
       A.agncy_dvsn_cdv AS "A.agncyDvsnCdv",
       A.brno AS "A.brno",
       A.crs_grd_cdv AS "A.crsGrdCdv",
       A.telno AS "A.telno",
       A.fax AS "A.fax",
       A.bnk_cdv AS "A.bnkCdv",
       A.accno AS "A.accno",
       A.acchdr AS "A.acchdr",
       A.zipc AS "A.zipc",
       A.addr AS "A.addr",       
       A.addr_sido AS "A.addrSido",
       A.addr_sigungu AS "A.addrSigungu",
       A.addr_dtl AS "A.addrDtl",
       A.area_cdv AS "A.areaCdv",
       A.area_dtl AS "A.areaDtl",
       A.agncy_url AS "A.agncyUrl",
       A.logo_file_id AS "A.logoFileId",
       A.seal_file_id AS "A.sealFileId",
       A.dsgn_yn AS "A.dsgnYn",
       A.link_code AS "A.linkCode",
       A.fnsh_code AS "A.fnshCode",
       A.del_yn AS "A.delYn",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp"
  
  FROM im_agncy A
 WHERE
       agncy_id = #{agncyId}

   AND A.del_yn = 'N'
    </select>


    <resultMap id="selectListResultMap" type="com.intermorph.crs.agncy.service.IMAgncyResultSet">
        <result column="A.agncyId" property="agncy.agncyId"/>
        <result column="A.agncyNm" property="agncy.agncyNm"/>
        <result column="A.agncyDvsnCdv" property="agncy.agncyDvsnCdv"/>
        <result column="A.brno" property="agncy.brno"/>
        <result column="A.crsGrdCdv" property="agncy.crsGrdCdv"/>
        <result column="A.telno" property="agncy.telno"/>
        <result column="A.fax" property="agncy.fax"/>
        <result column="A.bnkCdv" property="agncy.bnkCdv"/>
        <result column="A.accno" property="agncy.accno"/>
        <result column="A.acchdr" property="agncy.acchdr"/>
        <result column="A.zipc" property="agncy.zipc"/>
        <result column="A.addr" property="agncy.addr"/>
        <result column="A.addrSido" property="agncy.addrSido"/>
        <result column="A.addrSigungu" property="agncy.addrSigungu"/>
        <result column="A.addrDtl" property="agncy.addrDtl"/>
        <result column="A.areaCdv" property="agncy.areaCdv"/>
        <result column="A.areaDtl" property="agncy.areaDtl"/>
        <result column="A.agncyUrl" property="agncy.agncyUrl"/>
        <result column="A.logoFileId" property="agncy.logoFileId"/>
        <result column="A.sealFileId" property="agncy.sealFileId"/>
        <result column="A.dsgnYn" property="agncy.dsgnYn"/>
        <result column="A.linkCode" property="agncy.linkCode"/>
        <result column="A.fnshCode" property="agncy.fnshCode"/>
        <result column="A.delYn" property="agncy.delYn"/>
        <result column="A.frstRegerId" property="agncy.frstRegerId"/>
        <result column="A.frstRegDt" property="agncy.frstRegDt"/>
        <result column="A.frstRegerIp" property="agncy.frstRegerIp"/>
        <result column="A.lastMdferId" property="agncy.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="agncy.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="agncy.lastMdferIp"/>
        <result column="cmmnDesc" property="agncy.cmmnDesc"/>

    </resultMap>
    <select id="selectList" parameterType="com.intermorph.crs.agncy.service.IMAgncyCondition" resultMap="selectListResultMap">
/* IMAgncyMapper.selectList */
         <if test='currentPageNo != 0'>
SELECT * FROM ( SELECT rownum rn, TB.* FROM (
        </if>
SELECT
       A.agncy_id AS "A.agncyId",
       A.agncy_nm AS "A.agncyNm",
       A.agncy_dvsn_cdv AS "A.agncyDvsnCdv",
       A.brno AS "A.brno",
       A.crs_grd_cdv AS "A.crsGrdCdv",
       A.telno AS "A.telno",
       A.fax AS "A.fax",
       A.bnk_cdv AS "A.bnkCdv",
       A.accno AS "A.accno",
       A.acchdr AS "A.acchdr",
       A.zipc AS "A.zipc",
       A.addr AS "A.addr",
       A.addr_sido AS "A.addrSido",
       A.addr_sigungu AS "A.addrSigungu",
       A.addr_dtl AS "A.addrDtl",
       A.area_cdv AS "A.areaCdv",
       A.area_dtl AS "A.areaDtl",       
       A.agncy_url AS "A.agncyUrl",
       A.logo_file_id AS "A.logoFileId",
       A.seal_file_id AS "A.sealFileId",       
       A.dsgn_yn AS "A.dsgnYn",
       A.link_code AS "A.linkCode",
       A.fnsh_code AS "A.fnshCode",
       A.del_yn AS "A.delYn",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp"
       ,(SELECT cmmn_desc FROM im_cmmn_desc ICD where ICD.tbl_ref_id = A.agncy_id AND tbl_id='IM_AGNCY' AND ref_nm='agncyintro' ) as cmmnDesc

  FROM im_agncy A
 WHERE A.del_yn = 'N'
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("agncyNm")'>
       			AND A.agncy_nm LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("brno")'>
       			AND A.brno LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
<!--         <if test='scCrsGrdCdv != null and !scCrsGrdCdv.equals("")'> -->
<!--        			AND A.crs_grd_cdv LIKE CONCAT('%', #{scCrsGrdCdv}, '%') -->
<!--         </if> -->
        <if test='scAgncyDvsnCdv != null and !scAgncyDvsnCdv.equals("")'>
       			AND A.agncy_dvsn_cdv = #{scAgncyDvsnCdv}
        </if>
        <if test='scNotAgncyDvsnCdv != null and !scNotAgncyDvsnCdv.equals("")'>
       			AND A.agncy_dvsn_cdv != #{scNotAgncyDvsnCdv}
        </if>
        <if test='scAreaCdv != null and !scAreaCdv.equals("")'>
       			AND A.area_cdv = #{scAreaCdv}
        </if>
        <if test='scDsgnYn != null and !scDsgnYn.equals("")'>
       			AND A.dsgn_yn = #{scDsgnYn}
        </if>
 
        <if test='scLinkCode != null and !scLinkCode.equals("")'>
       			AND A.link_code = #{scLinkCode}
        </if>
 
  		<choose>
            <when test='orderbyKey == 2'>ORDER BY A.agncy_nm ASC</when>
            <when test='orderbyKey == -2'>ORDER BY A.agncy_nm DESC</when>
            <when test='orderbyKey == 1'>ORDER BY A.frst_reg_dt ASC</when>
            <when test='orderbyKey == -1'>ORDER BY A.frst_reg_dt DESC</when>
            <otherwise>ORDER BY A.frst_reg_dt DESC</otherwise>
        </choose>

        <if test='currentPageNo != 0'>
        ) TB ) WHERE rn BETWEEN #{firstItemNo}+1  AND #{firstItemNo} + #{recordCountPerPage}
        </if>
    </select>

    <select id="selectListCount" parameterType="com.intermorph.crs.agncy.service.IMAgncyCondition" resultType="int">
/* IMAgncyMapper.selectListCount */
SELECT COUNT(*) 
  FROM im_agncy A
 WHERE A.del_yn = 'N' 
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("agncyNm")'>
       			AND A.agncy_nm LIKE CONCAT('%', #{scWord}, '%')
            </if>
            <if test='scKey.equals("brno")'>
       			AND A.brno LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
        <if test='scCrsGrdCdv != null and !scCrsGrdCdv.equals("")'>
       			AND A.crs_grd_cdv LIKE CONCAT('%', #{scCrsGrdCdv}, '%')
        </if>
        <if test='scAgncyDvsnCdv != null and !scAgncyDvsnCdv.equals("")'>
       			AND A.agncy_dvsn_cdv = #{scAgncyDvsnCdv}
        </if> 
        
        <if test='scNotAgncyDvsnCdv != null and !scNotAgncyDvsnCdv.equals("")'>
       			AND A.agncy_dvsn_cdv != #{scNotAgncyDvsnCdv}
        </if>
        <if test='scAreaCdv != null and !scAreaCdv.equals("")'>
       			AND A.area_cdv = #{scAreaCdv}
        </if>
        
        <if test='scDsgnYn != null and !scDsgnYn.equals("")'>
       			AND A.dsgn_yn = #{scDsgnYn}
        </if>
        
        <if test='scLinkCode != null and !scLinkCode.equals("")'>
       			AND A.link_code = #{scLinkCode}
        </if>
    </select>
    
    
    <select id="selectOverCount" parameterType="com.intermorph.crs.agncy.service.IMAgncyVO" resultType="int">
/* IMAgncyMapper.selectOverCount */
SELECT COUNT(*) 
  FROM im_agncy A
 WHERE A.del_yn = 'N'
       	AND A.brno = #{brno}
        <if test='agncyId != null and !agncyId.equals("")'>
       			AND A.agncy_id != #{agncyId} 
        </if> 
    </select>
</mapper>