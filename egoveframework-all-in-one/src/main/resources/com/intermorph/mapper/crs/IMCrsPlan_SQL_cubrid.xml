<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.intermorph.crs.plan.service.IMCrsPlanMapper">

    <insert id="insert" parameterType="com.intermorph.crs.plan.service.IMCrsPlanVO" useGeneratedKeys="false">
/* IMCrsPlanMapper.insert */
INSERT INTO im_crs_plan (
    crs_plan_id,
    agncy_id,
    edu_year,
    crs_grd_cdv,
    crs_dvsn_cdv,

    del_yn,
    frst_reger_id,
    frst_reg_dt,
    frst_reger_ip
) VALUES (
    #{crsPlanId, jdbcType=VARCHAR},
    #{agncyId, jdbcType=VARCHAR},
    #{eduYear, jdbcType=VARCHAR},
    #{crsGrdCdv, jdbcType=VARCHAR},
    #{crsDvsnCdv, jdbcType=VARCHAR},

     'N',
    #{frstRegerId, jdbcType=VARCHAR},
    TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
    #{frstRegerIp, jdbcType=VARCHAR}
) 
    </insert>

    <update id="update" parameterType="com.intermorph.crs.plan.service.IMCrsPlanVO">
/* IMCrsPlanMapper.update */
UPDATE im_crs_plan
   SET 
       crs_plan_id = #{crsPlanId, jdbcType=VARCHAR},
       agncy_id = #{agncyId, jdbcType=VARCHAR},
       edu_year = #{eduYear, jdbcType=VARCHAR},
       crs_grd_cdv = #{crsGrdCdv, jdbcType=VARCHAR},
       crs_dvsn_cdv = #{crsDvsnCdv, jdbcType=VARCHAR},

	   last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR}
 WHERE
       crs_plan_id = #{crsPlanId}

   AND del_yn = 'N' 
    </update>

    <update id="delete" parameterType="com.intermorph.crs.plan.service.IMCrsPlanVO">
/* IMCrsPlanMapper.delete */
UPDATE im_crs_plan 
   SET last_mdfer_id = #{lastMdferId, jdbcType=VARCHAR},
       last_mdfcn_dt = TO_CHAR(SYSDATETIME, 'yyyymmddhh24miss'),
       last_mdfer_ip = #{lastMdferIp, jdbcType=VARCHAR},
       del_yn = 'Y' 
 WHERE 
       crs_plan_id = #{crsPlanId}

   AND del_yn = 'N'
    </update>

    <resultMap id="selectDetailResultMap" type="com.intermorph.crs.plan.service.IMCrsPlanResultSet">
        <result column="A.crsPlanId" property="crsPlan.crsPlanId"/>
        <result column="A.agncyId" property="crsPlan.agncyId"/>
        <result column="A.eduYear" property="crsPlan.eduYear"/>
        <result column="A.crsGrdCdv" property="crsPlan.crsGrdCdv"/>
        <result column="A.crsDvsnCdv" property="crsPlan.crsDvsnCdv"/>
        <result column="A.delYn" property="crsPlan.delYn"/>
        <result column="A.frstRegerId" property="crsPlan.frstRegerId"/>
        <result column="A.frstRegDt" property="crsPlan.frstRegDt"/>
        <result column="A.frstRegerIp" property="crsPlan.frstRegerIp"/>
        <result column="A.lastMdferId" property="crsPlan.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="crsPlan.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="crsPlan.lastMdferIp"/>
        <result column="E.agncyNm" property="agncy.agncyNm"/>

    </resultMap>
    <select id="selectDetail" parameterType="com.intermorph.crs.plan.service.IMCrsPlanVO" resultMap="selectDetailResultMap">
        /* IMCrsPlanMapper.selectDetail */
SELECT 
       A.crs_plan_id AS "A.crsPlanId",
       A.agncy_id AS "A.agncyId",
       A.edu_year AS "A.eduYear",
       A.crs_grd_cdv AS "A.crsGrdCdv",
       A.crs_dvsn_cdv AS "A.crsDvsnCdv",
       A.del_yn AS "A.delYn",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp",
       E.agncy_nm AS "E.agncyNm"
  
  FROM im_crs_plan A
  INNER JOIN im_agncy E ON A.agncy_id=E.agncy_id
 WHERE
       crs_plan_id = #{crsPlanId}

   AND A.del_yn = 'N'
    </select>


    <resultMap id="selectListResultMap" type="com.intermorph.crs.plan.service.IMCrsPlanResultSet">
        <result column="A.crsPlanId" property="crsPlan.crsPlanId"/>
        <result column="A.agncyId" property="crsPlan.agncyId"/>
        <result column="A.eduYear" property="crsPlan.eduYear"/>
        <result column="A.crsGrdCdv" property="crsPlan.crsGrdCdv"/>
        <result column="A.crsDvsnCdv" property="crsPlan.crsDvsnCdv"/>
        <result column="A.delYn" property="crsPlan.delYn"/>
        <result column="A.frstRegerId" property="crsPlan.frstRegerId"/>
        <result column="A.frstRegDt" property="crsPlan.frstRegDt"/>
        <result column="A.frstRegerIp" property="crsPlan.frstRegerIp"/>
        <result column="A.lastMdferId" property="crsPlan.lastMdferId"/>
        <result column="A.lastMdfcnDt" property="crsPlan.lastMdfcnDt"/>
        <result column="A.lastMdferIp" property="crsPlan.lastMdferIp"/>
        <result column="A.eduAplTerm_bgnDt" property="crsPlan.eduAplTerm_bgnDt"/>
        <result column="A.eduAplTerm_endDt" property="crsPlan.eduAplTerm_endDt"/>
        <result column="A.eduTerm_bgnDt" property="crsPlan.eduTerm_bgnDt"/>
        <result column="A.eduTerm_endDt" property="crsPlan.eduTerm_endDt"/>
        <result column="E.agncyNm" property="agncy.agncyNm"/>

    </resultMap>
    <select id="selectList" parameterType="com.intermorph.crs.plan.service.IMCrsPlanCondition" resultMap="selectListResultMap">
/* IMCrsPlanMapper.selectList */
         <if test='currentPageNo != 0'>
SELECT * FROM ( SELECT rownum rn, TB.* FROM (
        </if>
SELECT
       A.crs_plan_id AS "A.crsPlanId",
       A.agncy_id AS "A.agncyId",
       A.edu_year AS "A.eduYear",
       A.crs_grd_cdv AS "A.crsGrdCdv",
       A.crs_dvsn_cdv AS "A.crsDvsnCdv",
       A.del_yn AS "A.delYn",
       A.frst_reger_id AS "A.frstRegerId",
       A.frst_reg_dt AS "A.frstRegDt",
       A.frst_reger_ip AS "A.frstRegerIp",
       A.last_mdfer_id AS "A.lastMdferId",
       A.last_mdfcn_dt AS "A.lastMdfcnDt",
       A.last_mdfer_ip AS "A.lastMdferIp",
       C.bgn_dt AS "A.eduAplTerm_bgnDt" ,
       C.end_dt AS "A.eduAplTerm_endDt" ,       
       D.bgn_dt AS "A.eduTerm_bgnDt" ,
       D.end_dt AS "A.eduTerm_endDt" ,
       E.agncy_nm AS "E.agncyNm"

  FROM im_crs_plan A
  INNER JOIN im_cmmn_dt C ON A.crs_plan_id=C.tbl_ref_id AND C.tbl_id='IM_CRS_PLAN' AND C.ref_nm='eduAplTerm'
  INNER JOIN im_cmmn_dt D ON A.crs_plan_id=D.tbl_ref_id AND D.tbl_id='IM_CRS_PLAN' AND D.ref_nm='eduTerm'
  INNER JOIN im_agncy E ON A.agncy_id=E.agncy_id
 WHERE A.del_yn = 'N'
 
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("crsPlanId")'>
       			AND A.crs_plan_id LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
        <if test='scCrsGrdCdv != null and !scCrsGrdCdv.equals("")'>
       			AND A.crs_grd_cdv = #{scCrsGrdCdv}
        </if>
        <if test='scCrsDvsnCdv != null and !scCrsDvsnCdv.equals("")'>
       			AND A.crs_dvsn_cdv = #{scCrsDvsnCdv}
        </if>
        <if test='scAgncyId != null and !scAgncyId.equals("")'>
       			AND A.agncy_id = #{scAgncyId}
        </if>
        <if test='scEduYear != null and !scEduYear.equals("")'>
       			AND A.edu_year = #{scEduYear}
        </if>
        <if test='scEduAplTermStartYear != null and !scEduAplTermStartYear.equals("")'>
       			AND C.bgn_dt LIKE CONCAT(#{scEduAplTermStartYear},'%')
        </if>
 
  		<choose>
  			<when test='orderbyKey == 3'>ORDER BY  D.bgn_dt ASC</when>
            <when test='orderbyKey == -3'>ORDER BY  D.bgn_dt DESC</when>
            <when test='orderbyKey == 2'>ORDER BY  C.bgn_dt ASC</when>
            <when test='orderbyKey == -2'>ORDER BY  C.bgn_dt DESC</when>
            <when test='orderbyKey == 1'>ORDER BY A.frst_reg_dt ASC</when>
            <when test='orderbyKey == -1'>ORDER BY A.frst_reg_dt DESC</when>
            <otherwise>ORDER BY A.frst_reg_dt DESC</otherwise>
        </choose>

        <if test='currentPageNo != 0'>
        ) TB ) WHERE rn BETWEEN #{firstItemNo}+1  AND #{firstItemNo} + #{recordCountPerPage}
        </if>
    </select>

    <select id="selectListCount" parameterType="com.intermorph.crs.plan.service.IMCrsPlanCondition" resultType="int">
/* IMCrsPlanMapper.selectListCount */
SELECT COUNT(*) 
  FROM im_crs_plan A
 WHERE A.del_yn = 'N'  
 		<if test='scWord != null and !scWord.equals("")'>
            <if test='scKey.equals("crsPlanId")'>
       			AND A.crs_plan_id LIKE CONCAT('%', #{scWord}, '%')
            </if>
        </if>
        <if test='scCrsGrdCdv != null and !scCrsGrdCdv.equals("")'>
       			AND A.crs_grd_cdv = #{scCrsGrdCdv}
        </if>
        <if test='scCrsDvsnCdv != null and !scCrsDvsnCdv.equals("")'>
       			AND A.crs_dvsn_cdv = #{scCrsDvsnCdv}
        </if>
        <if test='scAgncyId != null and !scAgncyId.equals("")'>
       			AND A.agncy_id = #{scAgncyId}
        </if>
        <if test='scEduYear != null and !scEduYear.equals("")'>
       			AND A.edu_year = #{scEduYear}
        </if>
        
        <if test='scEduAplTermStartYear != null and !scEduAplTermStartYear.equals("")'>
       			AND C.bgn_dt LIKE CONCAT(#{scEduAplTermStartYear},'%')
        </if>
    </select>
</mapper>